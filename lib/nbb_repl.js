import { $APP, shadow$provide, $jscomp } from "./nbb_core.js";
import "./nbb_api.js";
const shadow_esm_import = function(x) { return import(x) };
import*as esm_import$node_net from"node:net";import*as esm_import$node_process from"node:process";import*as esm_import$node_readline from"node:readline";import*as esm_import$node_vm from"node:vm";
var bV=function(a){var b=function(){var e=$APP.Dr.h(a,"(");return $APP.k(e)?new $APP.H(null,2,5,$APP.I,[$APP.Yi.j(a,0,e+1),$APP.Yi.h(a,e+1)],null):new $APP.H(null,2,5,$APP.I,[null,a],null)}(),c=$APP.y.j(b,0,null),d=$APP.y.j(b,1,null);b=$APP.C.h(function(){try{return $APP.WKa(new $APP.h(null,2,[$APP.Q,$APP.m.g($APP.n(aV)),$APP.zI,d],null))}catch(f){var e=f;console.warn($APP.m.g($APP.dAa),$APP.gk(e));return null}}(),"completions");return $APP.ej.h(function(e){return[$APP.m.g(c),$APP.m.g(e)].join("")},
$APP.Tg(function(e){return $APP.Ea(e,d)},$APP.ej.h(function(e){return $APP.C.h(e,"candidate")},b)))},uWa=function(a){return[$APP.ws.g(bV(a)),a]},vWa=function(a,b){$APP.vg(cV,!1);a.setPrompt([$APP.m.g($APP.n(aV)),"\x3d\x3e "].join(""));a.prompt();return $APP.hl($APP.n(dV))?null:eV.h?eV.h(b,a):eV.call(null,b,a)},wWa=function(a){var b=$APP.ul(a);a=$APP.vl(a);var c=$APP.gl($APP.n(dV));b=$APP.Eg.h(b-1,c);c=$APP.r(b);b=$APP.v(c);c=$APP.w(c);a=$APP.k(b)?$APP.Yi.h(b,a):null;$APP.vg(dV,$APP.mn.h("\n",$APP.yf(a,
c)))},xWa=function(a,b){b={f:b};esm_import$node_vm.createContext(b);try{return $APP.k($APP.k(fV)?$APP.Cb(a):fV)&&esm_import$node_process.stdin.setRawMode(!1),esm_import$node_vm.runInContext("f()",b,{displayErrors:!0,breakOnSigint:!0,microtaskMode:"afterEvaluate"}).then(function(c){var d={f:$APP.k(a)?function(){return c}:function(){var e=$APP.v(c);$APP.yu.l($APP.z([e]));return c}};esm_import$node_vm.createContext(d);return esm_import$node_vm.runInContext("f()",d,{displayErrors:!0,breakOnSigint:!0,
microtaskMode:"afterEvaluate"})}).finally(function(){return $APP.k($APP.k(fV)?$APP.Cb(a):fV)?esm_import$node_process.stdin.setRawMode(!0):null})}catch(c){return b=c,$APP.k($APP.k(fV)?$APP.Cb(a):fV)&&esm_import$node_process.stdin.setRawMode(!0),Promise.reject(b)}},eV=function(a,b){if($APP.k(function(){var e=$APP.n(cV);return $APP.k(e)?e:$APP.hl($APP.n(dV))}()))return null;$APP.vg(cV,!0);var c=$APP.wp($APP.n(dV)),d=function(){try{var e=$APP.Wf([$APP.Lq,$APP.n(aV)]);$APP.Xp(e);try{return $APP.$ia(c)}finally{$APP.Zp()}}catch(f){e=
f;if($APP.Ha($APP.gk(e),"EOF while reading"))return yWa;wWa(c);$APP.yu.l($APP.z([$APP.m.g(e)]));return zWa}}();if($APP.x.h(zWa,d))return vWa(b,a);if($APP.x.h(yWa,d))return $APP.vg(cV,!1);wWa(c);if($APP.x.h($APP.WH,d))return $APP.vg(cV,!1);$APP.Xp($APP.Wf([$APP.Lq,$APP.n(aV)]));return xWa(a,function(){return $APP.LKa(d,new $APP.h(null,3,[$APP.Q,$APP.n(aV),$APP.Vl,$APP.n($APP.xq),$APP.dK,$APP.Fw],null))}).then(function(e){var f=$APP.y.j(e,0,null);e=$APP.y.j(e,1,null);e=$APP.Yf(e);e=$APP.C.h(e,$APP.Q);
$APP.vg(aV,e);$APP.AO.h($APP.jO,$APP.sg($APP.n($APP.iO)));$APP.AO.h($APP.iO,$APP.sg($APP.n($APP.hO)));$APP.AO.h($APP.hO,$APP.sg(f));$APP.k(a)&&a.write($APP.Oy.l($APP.z([f])));return vWa(b,a)}).catch(function(e){$APP.yu.l($APP.z([$APP.m.g(e)]));$APP.AO.h($APP.kO,$APP.sg(e));return vWa(b,a)}).finally(function(){return $APP.Zp()})},AWa=function(a,b){a.on("line",function(c){$APP.Bj.F(dV,$APP.m,c,"\n");return eV(b,a)})},BWa=function(a){return esm_import$node_readline.createInterface({input:a,output:a,
completer:uWa})},CWa=function(a){var b=BWa(a);AWa(b,a);a.setNoDelay(!0);return a.on("close",function(){return $APP.Ry.l($APP.z(["Client closed connection."]))})},DWa=new $APP.q(null,"nbb.impl.repl","nbb.impl.repl",-339140484,null),yWa=new $APP.F("nbb.impl.repl","eof-while-reading","nbb.impl.repl/eof-while-reading",1743626215),EWa=new $APP.q("nbb.impl.repl","completer*","nbb.impl.repl/completer*",455172317,null),FWa=new $APP.q("nbb.impl.repl","repl","nbb.impl.repl/repl",-1645296655,null),GWa=new $APP.q(null,
"completer*","completer*",-648150376,null),HWa=new $APP.q("nbb.impl.repl","socket-repl","nbb.impl.repl/socket-repl",1509490200,null),IWa=new $APP.F(null,"init","init",-1875481434),JWa=new $APP.q(null,"get-completions","get-completions",1933789168,null),zWa=new $APP.F("nbb.impl.repl","continue","nbb.impl.repl/continue",-1326808644);var aV=$APP.Aj.g($APP.n($APP.Lq)),dV=$APP.Aj.g(""),cV=$APP.Aj.g(!1),fV,KWa=esm_import$node_process.stdout.isTTY;fV=$APP.k(KWa)?esm_import$node_process.stdin.setRawMode:KWa;var LWa=$APP.EO.h($APP.lz,null),gV=function gV(a){switch(arguments.length){case 0:return gV.D();case 1:return gV.g(arguments[0]);default:throw Error(["Invalid arity: ",$APP.m.g(arguments.length)].join(""));}};gV.D=function(){return gV.g(null)};
gV.g=function(a){var b=function(){var d=$APP.yH.g(a);return $APP.k(d)?d:0}(),c=esm_import$node_net.createServer(CWa);return c.listen(b,"127.0.0.1",function(){var d=c.address(),e=d.address;return $APP.Ry.l($APP.z([["Socket REPL listening on port ",$APP.m.g(d.port)," on host ",$APP.m.g(e)].join("")]))})};gV.B=1;var hV=function hV(a){switch(arguments.length){case 0:return hV.D();case 1:return hV.g(arguments[0]);default:throw Error(["Invalid arity: ",$APP.m.g(arguments.length)].join(""));}};hV.D=function(){return hV.g(null)};
hV.g=function(a){function b(e){return $APP.IKa(new $APP.D(null,$APP.Ak,new $APP.D(null,new $APP.D(null,$APP.Ak,new $APP.D(null,e,null,1,null),2,null),null,1,null),2,null))}$APP.k(fV)&&esm_import$node_process.stdin.setRawMode(!0);var c=$APP.y.j($APP.LO,0,null),d=$APP.y.j($APP.LO,1,null);$APP.Ry.l($APP.z([["Welcome to nbb-logseq v",$APP.gv(),"!"].join("")]));return b(c).then(function(){return b(d)}).then(IWa.h(a,$APP.ef)).then(function(){return new Promise(function(e){var f=$APP.k(null)?BWa(null):esm_import$node_readline.createInterface({input:esm_import$node_process.stdin,
output:esm_import$node_process.stdout,completer:uWa});AWa(f,null);f.setPrompt([$APP.m.g($APP.n(aV)),"\x3d\x3e "].join(""));f.on("close",e);return f.prompt()})})};hV.B=1;
var MWa=new $APP.h(null,3,[$APP.YKa,function(){var a=new $APP.Cd(function(){return hV},FWa,$APP.gi([$APP.Q,$APP.N,$APP.Vl,$APP.Vz,$APP.SJ,$APP.Om,$APP.Wl,$APP.YL,$APP.V,$APP.M,$APP.oG],[DWa,$APP.YKa,"nbb/impl/repl.cljs",11,new $APP.h(null,6,[$APP.BA,!1,$APP.Os,1,$APP.cL,1,$APP.LK,new $APP.H(null,2,5,$APP.I,[$APP.Sg,new $APP.H(null,1,5,$APP.I,[$APP.DH],null)],null),$APP.V,$APP.J($APP.Sg,new $APP.H(null,1,5,$APP.I,[$APP.DH],null)),$APP.gG,$APP.J(null,null)],null),1,187,187,$APP.J($APP.Sg,new $APP.H(null,
1,5,$APP.I,[$APP.DH],null)),null,$APP.k(hV)?hV.H:null])),b=$APP.n(a),c=$APP.se(a);a=$APP.k(null)?null:$APP.N.g(c);var d=new $APP.h(null,4,[$APP.Q,LWa,$APP.N,a,$APP.V,$APP.V.g(c),$APP.M,$APP.M.g(c)],null);return $APP.k($APP.Sq.g(c))?$APP.yO.j(a,b,d):$APP.k(function(){var e=$APP.mq.g(c);return $APP.k(e)?e:$APP.zq.g(c)}())?$APP.zO.j(a,b,d):$APP.gu.j(a,b,d)}(),JWa,function(){var a=new $APP.Cd(function(){return bV},EWa,$APP.gi([$APP.Q,$APP.N,$APP.Vl,$APP.Vz,$APP.Om,$APP.Wl,$APP.YL,$APP.V,$APP.M,$APP.oG],
[DWa,GWa,"nbb/impl/repl.cljs",17,1,16,16,$APP.J(new $APP.H(null,1,5,$APP.I,[$APP.Tna],null)),"Given a line, returns a flat vector of completions",$APP.k(bV)?bV.H:null])),b=$APP.n(a),c=$APP.se(a);a=$APP.k(null)?null:$APP.N.g(c);var d=new $APP.h(null,4,[$APP.Q,LWa,$APP.N,a,$APP.V,$APP.V.g(c),$APP.M,$APP.M.g(c)],null);return $APP.k($APP.Sq.g(c))?$APP.yO.j(a,b,d):$APP.k(function(){var e=$APP.mq.g(c);return $APP.k(e)?e:$APP.zq.g(c)}())?$APP.zO.j(a,b,d):$APP.gu.j(a,b,d)}(),$APP.XKa,function(){var a=new $APP.Cd(function(){return gV},
HWa,$APP.gi([$APP.Q,$APP.N,$APP.Vl,$APP.Vz,$APP.SJ,$APP.Om,$APP.Wl,$APP.YL,$APP.V,$APP.M,$APP.oG],[DWa,$APP.XKa,"nbb/impl/repl.cljs",18,new $APP.h(null,6,[$APP.BA,!1,$APP.Os,1,$APP.cL,1,$APP.LK,new $APP.H(null,2,5,$APP.I,[$APP.Sg,new $APP.H(null,1,5,$APP.I,[$APP.DH],null)],null),$APP.V,$APP.J($APP.Sg,new $APP.H(null,1,5,$APP.I,[$APP.DH],null)),$APP.gG,$APP.J(null,null)],null),1,172,172,$APP.J($APP.Sg,new $APP.H(null,1,5,$APP.I,[$APP.DH],null)),null,$APP.k(gV)?gV.H:null])),b=$APP.n(a),c=$APP.se(a);
a=$APP.k(null)?null:$APP.N.g(c);var d=new $APP.h(null,4,[$APP.Q,LWa,$APP.N,a,$APP.V,$APP.V.g(c),$APP.M,$APP.M.g(c)],null);return $APP.k($APP.Sq.g(c))?$APP.yO.j(a,b,d):$APP.k(function(){var e=$APP.mq.g(c);return $APP.k(e)?e:$APP.zq.g(c)}())?$APP.zO.j(a,b,d):$APP.gu.j(a,b,d)}()],null);$APP.Wu(new $APP.h(null,1,[$APP.Iq,new $APP.h(null,1,[$APP.lz,MWa],null)],null));