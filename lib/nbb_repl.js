import { $APP, shadow$provide, $jscomp } from "./nbb_core.js";
import "./nbb_api.js";
const shadow_esm_import = function(x) { return import(x) };
import*as esm_import$node_net from"node:net";import*as esm_import$node_process from"node:process";import*as esm_import$node_readline from"node:readline";import*as esm_import$node_vm from"node:vm";
var IT=function(a){var b=function(){var e=$APP.Gr.h(a,"(");return $APP.k(e)?new $APP.H(null,2,5,$APP.J,[$APP.Yi.j(a,0,e+1),$APP.Yi.h(a,e+1)],null):new $APP.H(null,2,5,$APP.J,[null,a],null)}(),c=$APP.y.j(b,0,null),d=$APP.y.j(b,1,null);b=$APP.A.h(function(){try{return $APP.DMa(new $APP.h(null,2,[$APP.R,$APP.l.g($APP.n(HT)),$APP.YG,d],null))}catch(f){var e=f;console.warn($APP.l.g($APP.PBa),$APP.gk(e));return null}}(),"completions");return $APP.fj.h(function(e){return[$APP.l.g(c),$APP.l.g(e)].join("")},
$APP.Tg(function(e){return $APP.Da(e,d)},$APP.fj.h(function(e){return $APP.A.h(e,"candidate")},b)))},aYa=function(a){return[$APP.zs.g(IT(a)),a]},bYa=function(a,b){$APP.vg(JT,!1);a.setPrompt([$APP.l.g($APP.n(HT)),"\x3d\x3e "].join(""));a.prompt();return $APP.hl($APP.n(KT))?null:LT.h?LT.h(b,a):LT.call(null,b,a)},cYa=function(a){var b=$APP.ul(a);a=$APP.vl(a);var c=$APP.gl($APP.n(KT));b=$APP.Eg.h(b-1,c);c=$APP.r(b);b=$APP.v(c);c=$APP.w(c);a=$APP.k(b)?$APP.Yi.h(b,a):null;$APP.vg(KT,$APP.on.h("\n",$APP.Af(a,
c)))},dYa=function(a,b){b={f:b};esm_import$node_vm.createContext(b);try{return $APP.k($APP.k(MT)?$APP.Cb(a):MT)&&esm_import$node_process.stdin.setRawMode(!1),esm_import$node_vm.runInContext("f()",b,{displayErrors:!0,breakOnSigint:!0,microtaskMode:"afterEvaluate"}).then(function(c){var d={f:$APP.k(a)?function(){return c}:function(){var e=$APP.v(c);$APP.Du.l($APP.z([e]));return c}};esm_import$node_vm.createContext(d);return esm_import$node_vm.runInContext("f()",d,{displayErrors:!0,breakOnSigint:!0,
microtaskMode:"afterEvaluate"})}).finally(function(){return $APP.k($APP.k(MT)?$APP.Cb(a):MT)?esm_import$node_process.stdin.setRawMode(!0):null})}catch(c){return b=c,$APP.k($APP.k(MT)?$APP.Cb(a):MT)&&esm_import$node_process.stdin.setRawMode(!0),Promise.reject(b)}},LT=function(a,b){if($APP.k(function(){var e=$APP.n(JT);return $APP.k(e)?e:$APP.hl($APP.n(KT))}()))return null;$APP.vg(JT,!0);var c=$APP.zp($APP.n(KT)),d=function(){try{var e=$APP.Vf([$APP.Nq,$APP.n(HT)]);$APP.bq(e);try{return $APP.Via(c)}finally{$APP.dq()}}catch(f){e=
f;if($APP.Ia($APP.gk(e),"EOF while reading"))return eYa;cYa(c);$APP.Du.l($APP.z([$APP.l.g(e)]));return fYa}}();if($APP.x.h(fYa,d))return bYa(b,a);if($APP.x.h(eYa,d))return $APP.vg(JT,!1);cYa(c);if($APP.x.h($APP.tG,d))return $APP.vg(JT,!1);$APP.bq($APP.Vf([$APP.Nq,$APP.n(HT)]));return dYa(a,function(){return $APP.sMa(d,new $APP.h(null,3,[$APP.R,$APP.n(HT),$APP.Sl,$APP.n($APP.wq),$APP.BI,$APP.Kw],null))}).then(function(e){var f=$APP.y.j(e,0,null);e=$APP.y.j(e,1,null);e=$APP.Xf(e);e=$APP.A.h(e,$APP.R);
$APP.vg(HT,e);$APP.gN.h($APP.QM,$APP.tg($APP.n($APP.PM)));$APP.gN.h($APP.PM,$APP.tg($APP.n($APP.OM)));$APP.gN.h($APP.OM,$APP.tg(f));$APP.k(a)&&a.write($APP.Ty.l($APP.z([f])));return bYa(b,a)}).catch(function(e){$APP.Du.l($APP.z([$APP.l.g(e)]));$APP.gN.h($APP.RM,$APP.tg(e));return bYa(b,a)}).finally(function(){return $APP.dq()})},gYa=function(a,b){a.on("line",function(c){$APP.Aj.F(KT,$APP.l,c,"\n");return LT(b,a)})},hYa=function(a){return esm_import$node_readline.createInterface({input:a,output:a,
completer:aYa})},iYa=function(a){var b=hYa(a);gYa(b,a);a.setNoDelay(!0);return a.on("close",function(){return $APP.Wy.l($APP.z(["Client closed connection."]))})},jYa=new $APP.q(null,"nbb.impl.repl","nbb.impl.repl",-339140484,null),eYa=new $APP.F("nbb.impl.repl","eof-while-reading","nbb.impl.repl/eof-while-reading",1743626215),kYa=new $APP.q("nbb.impl.repl","completer*","nbb.impl.repl/completer*",455172317,null),lYa=new $APP.q("nbb.impl.repl","repl","nbb.impl.repl/repl",-1645296655,null),mYa=new $APP.q(null,
"completer*","completer*",-648150376,null),nYa=new $APP.q("nbb.impl.repl","socket-repl","nbb.impl.repl/socket-repl",1509490200,null),oYa=new $APP.F(null,"init","init",-1875481434),pYa=new $APP.q(null,"get-completions","get-completions",1933789168,null),fYa=new $APP.F("nbb.impl.repl","continue","nbb.impl.repl/continue",-1326808644);var HT=$APP.zj.g($APP.n($APP.Nq)),KT=$APP.zj.g(""),JT=$APP.zj.g(!1),MT,qYa=esm_import$node_process.stdout.isTTY;MT=$APP.k(qYa)?esm_import$node_process.stdin.setRawMode:qYa;var rYa=$APP.kN.h($APP.qz,null),NT=function NT(a){switch(arguments.length){case 0:return NT.D();case 1:return NT.g(arguments[0]);default:throw Error(["Invalid arity: ",$APP.l.g(arguments.length)].join(""));}};NT.D=function(){return NT.g(null)};
NT.g=function(a){var b=function(){var d=$APP.XF.g(a);return $APP.k(d)?d:0}(),c=esm_import$node_net.createServer(iYa);return c.listen(b,"127.0.0.1",function(){var d=c.address(),e=d.address;return $APP.Wy.l($APP.z([["Socket REPL listening on port ",$APP.l.g(d.port)," on host ",$APP.l.g(e)].join("")]))})};NT.B=1;var OT=function OT(a){switch(arguments.length){case 0:return OT.D();case 1:return OT.g(arguments[0]);default:throw Error(["Invalid arity: ",$APP.l.g(arguments.length)].join(""));}};OT.D=function(){return OT.g(null)};
OT.g=function(a){function b(e){return $APP.pMa(new $APP.D(null,$APP.Ak,new $APP.D(null,new $APP.D(null,$APP.Ak,new $APP.D(null,e,null,1,null),2,null),null,1,null),2,null))}$APP.k(MT)&&esm_import$node_process.stdin.setRawMode(!0);var c=$APP.y.j($APP.rN,0,null),d=$APP.y.j($APP.rN,1,null);$APP.Wy.l($APP.z([["Welcome to nbb-logseq v",$APP.lv(),"!"].join("")]));return b(c).then(function(){return b(d)}).then(oYa.h(a,$APP.gf)).then(function(){return new Promise(function(e){var f=$APP.k(null)?hYa(null):esm_import$node_readline.createInterface({input:esm_import$node_process.stdin,
output:esm_import$node_process.stdout,completer:aYa});gYa(f,null);f.setPrompt([$APP.l.g($APP.n(HT)),"\x3d\x3e "].join(""));f.on("close",e);return f.prompt()})})};OT.B=1;
var sYa=new $APP.h(null,3,[$APP.FMa,function(){var a=new $APP.Ed(function(){return OT},lYa,$APP.gi([$APP.R,$APP.Q,$APP.Sl,$APP.$z,$APP.oI,$APP.Pm,$APP.Tl,$APP.DK,$APP.W,$APP.N,$APP.lF],[jYa,$APP.FMa,"nbb/impl/repl.cljs",11,new $APP.h(null,6,[$APP.EA,!1,$APP.Rs,1,$APP.BJ,1,$APP.jJ,new $APP.H(null,2,5,$APP.J,[$APP.Sg,new $APP.H(null,1,5,$APP.J,[$APP.bG],null)],null),$APP.W,$APP.K($APP.Sg,new $APP.H(null,1,5,$APP.J,[$APP.bG],null)),$APP.gF,$APP.K(null,null)],null),1,187,187,$APP.K($APP.Sg,new $APP.H(null,
1,5,$APP.J,[$APP.bG],null)),null,$APP.k(OT)?OT.H:null])),b=$APP.n(a),c=$APP.ue(a);a=$APP.k(null)?null:$APP.Q.g(c);var d=new $APP.h(null,4,[$APP.R,rYa,$APP.Q,a,$APP.W,$APP.W.g(c),$APP.N,$APP.N.g(c)],null);return $APP.k($APP.Uq.g(c))?$APP.eN.j(a,b,d):$APP.k(function(){var e=$APP.oq.g(c);return $APP.k(e)?e:$APP.yq.g(c)}())?$APP.fN.j(a,b,d):$APP.nu.j(a,b,d)}(),pYa,function(){var a=new $APP.Ed(function(){return IT},kYa,$APP.gi([$APP.R,$APP.Q,$APP.Sl,$APP.$z,$APP.Pm,$APP.Tl,$APP.DK,$APP.W,$APP.N,$APP.lF],
[jYa,mYa,"nbb/impl/repl.cljs",17,1,16,16,$APP.K(new $APP.H(null,1,5,$APP.J,[$APP.Rna],null)),"Given a line, returns a flat vector of completions",$APP.k(IT)?IT.H:null])),b=$APP.n(a),c=$APP.ue(a);a=$APP.k(null)?null:$APP.Q.g(c);var d=new $APP.h(null,4,[$APP.R,rYa,$APP.Q,a,$APP.W,$APP.W.g(c),$APP.N,$APP.N.g(c)],null);return $APP.k($APP.Uq.g(c))?$APP.eN.j(a,b,d):$APP.k(function(){var e=$APP.oq.g(c);return $APP.k(e)?e:$APP.yq.g(c)}())?$APP.fN.j(a,b,d):$APP.nu.j(a,b,d)}(),$APP.EMa,function(){var a=new $APP.Ed(function(){return NT},
nYa,$APP.gi([$APP.R,$APP.Q,$APP.Sl,$APP.$z,$APP.oI,$APP.Pm,$APP.Tl,$APP.DK,$APP.W,$APP.N,$APP.lF],[jYa,$APP.EMa,"nbb/impl/repl.cljs",18,new $APP.h(null,6,[$APP.EA,!1,$APP.Rs,1,$APP.BJ,1,$APP.jJ,new $APP.H(null,2,5,$APP.J,[$APP.Sg,new $APP.H(null,1,5,$APP.J,[$APP.bG],null)],null),$APP.W,$APP.K($APP.Sg,new $APP.H(null,1,5,$APP.J,[$APP.bG],null)),$APP.gF,$APP.K(null,null)],null),1,172,172,$APP.K($APP.Sg,new $APP.H(null,1,5,$APP.J,[$APP.bG],null)),null,$APP.k(NT)?NT.H:null])),b=$APP.n(a),c=$APP.ue(a);
a=$APP.k(null)?null:$APP.Q.g(c);var d=new $APP.h(null,4,[$APP.R,rYa,$APP.Q,a,$APP.W,$APP.W.g(c),$APP.N,$APP.N.g(c)],null);return $APP.k($APP.Uq.g(c))?$APP.eN.j(a,b,d):$APP.k(function(){var e=$APP.oq.g(c);return $APP.k(e)?e:$APP.yq.g(c)}())?$APP.fN.j(a,b,d):$APP.nu.j(a,b,d)}()],null);$APP.$u(new $APP.h(null,1,[$APP.Kq,new $APP.h(null,1,[$APP.qz,sYa],null)],null));