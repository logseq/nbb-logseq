import { $APP, shadow$provide, $jscomp } from "./nbb_core.js";
import "./nbb_api.js";
const shadow_esm_import = function(x) { return import(x) };
import*as esm_import$net from"net";import*as esm_import$readline from"readline";import*as esm_import$vm from"vm";
var BS=function(a){var b=function(){var e=$APP.Gq.h(a,"(");return $APP.l(e)?new $APP.H(null,2,5,$APP.I,[$APP.xi.j(a,0,e+1),$APP.xi.h(a,e+1)],null):new $APP.H(null,2,5,$APP.I,[null,a],null)}(),c=$APP.A.j(b,0,null),d=$APP.A.j(b,1,null);b=$APP.C.h(function(){try{return $APP.xCa(new $APP.k(null,2,[$APP.S,$APP.p.g($APP.q(AS)),$APP.XF,d],null))}catch(f){var e=f;console.warn($APP.p.g($APP.qua),$APP.Ij(e));return null}}(),"completions");return $APP.Gi.h(function(e){return[$APP.p.g(c),$APP.p.g(e)].join("")},
$APP.qg(function(e){return $APP.za(e,d)},$APP.Gi.h(function(e){return $APP.C.h(e,"candidate")},b)))},tFa=function(a){return[$APP.zr.g(BS(a)),a]},FS=function(a,b){$APP.Zf(CS,!1);a.setPrompt([$APP.p.g($APP.q(AS)),"\x3d\x3e "].join(""));a.prompt();return $APP.Jk($APP.q(DS))?null:ES.h?ES.h(b,a):ES.call(null,b,a)},uFa=function(a){var b=$APP.Xk(a);a=$APP.Yk(a);var c=$APP.Ik($APP.q(DS));b=$APP.ig.h(b-1,c);c=$APP.u(b);b=$APP.v(c);c=$APP.y(c);a=$APP.l(b)?$APP.xi.h(b,a):null;$APP.Zf(DS,$APP.Mm.h("\n",$APP.Ye(a,
c)))},vFa=function(a,b){b={f:b};esm_import$vm.createContext(b);try{return $APP.l($APP.l(GS)?$APP.jb(a):GS)&&process.stdin.setRawMode(!1),esm_import$vm.runInContext("f()",b,{displayErrors:!0,breakOnSigint:!0,microtaskMode:"afterEvaluate"}).then(function(c){var d={f:$APP.l(a)?function(){return c}:function(){var e=$APP.v(c);$APP.At.l($APP.B([e]));return c}};esm_import$vm.createContext(d);return esm_import$vm.runInContext("f()",d,{displayErrors:!0,breakOnSigint:!0,microtaskMode:"afterEvaluate"})}).finally(function(){return $APP.l($APP.l(GS)?
$APP.jb(a):GS)?process.stdin.setRawMode(!0):null})}catch(c){return b=c,$APP.l($APP.l(GS)?$APP.jb(a):GS)&&process.stdin.setRawMode(!0),Promise.reject(b)}},ES=function(a,b){if($APP.l(function(){var e=$APP.q(CS);return $APP.l(e)?e:$APP.Jk($APP.q(DS))}()))return null;$APP.Zf(CS,!0);var c=$APP.Bo($APP.q(DS)),d=function(){try{var e=$APP.vf([$APP.Np,$APP.q(AS)]);$APP.bp(e);try{return $APP.Fka(c)}finally{$APP.dp()}}catch(f){e=f;if(-1!=$APP.Ij(e).indexOf("EOF while reading"))return wFa;uFa(c);$APP.At.l($APP.B([$APP.p.g(e)]));
return xFa}}();if($APP.z.h(xFa,d))return FS(b,a);if($APP.z.h(wFa,d))return $APP.Zf(CS,!1);uFa(c);if($APP.z.h($APP.ME,d))return $APP.Zf(CS,!1);$APP.bp($APP.vf([$APP.Np,$APP.q(AS)]));return vFa(a,function(){return $APP.pCa(d,new $APP.k(null,3,[$APP.S,$APP.q(AS),$APP.ul,$APP.q($APP.zp),$APP.JI,$APP.qv],null))}).then(function(e){var f=$APP.A.j(e,0,null);e=$APP.A.j(e,1,null);e=$APP.xf(e);e=$APP.C.h(e,$APP.S);$APP.Zf(AS,e);$APP.zO.h($APP.gO,$APP.Xf($APP.q($APP.fO)));$APP.zO.h($APP.fO,$APP.Xf($APP.q($APP.eO)));
$APP.zO.h($APP.eO,$APP.Xf(f));$APP.l(a)&&a.write($APP.Lv.l($APP.B([f])));return FS(b,a)}).catch(function(e){$APP.At.l($APP.B([$APP.p.g(e)]));$APP.zO.h($APP.hO,$APP.Xf(e));return FS(b,a)}).finally(function(){return $APP.dp()})},yFa=function(a,b){a.on("line",function(c){$APP.dj.G(DS,$APP.p,c,"\n");return ES(b,a)})},zFa=function(a){return esm_import$readline.createInterface({input:a,output:a,completer:tFa})},AFa=function(a){var b=zFa(a);yFa(b,a);a.setNoDelay(!0);return a.on("close",function(){return $APP.Ov.l($APP.B(["Client closed connection."]))})},
HS=new $APP.t(null,"nbb.impl.repl","nbb.impl.repl",-339140484,null),wFa=new $APP.F("nbb.impl.repl","eof-while-reading","nbb.impl.repl/eof-while-reading",1743626215),BFa=new $APP.t("nbb.impl.repl","completer*","nbb.impl.repl/completer*",455172317,null),CFa=new $APP.t("nbb.impl.repl","repl","nbb.impl.repl/repl",-1645296655,null),DFa=new $APP.t(null,"completer*","completer*",-648150376,null),EFa=new $APP.t("nbb.impl.repl","socket-repl","nbb.impl.repl/socket-repl",1509490200,null),FFa=new $APP.F(null,
"init","init",-1875481434),GFa=new $APP.t(null,"get-completions","get-completions",1933789168,null),xFa=new $APP.F("nbb.impl.repl","continue","nbb.impl.repl/continue",-1326808644);var AS=$APP.cj.g($APP.q($APP.Np)),DS=$APP.cj.g(""),CS=$APP.cj.g(!1),GS,HFa=process.stdout.isTTY;GS=$APP.l(HFa)?process.stdin.setRawMode:HFa;var IS=$APP.DO.h($APP.iw,null),JS=function JS(a){switch(arguments.length){case 0:return JS.C();case 1:return JS.g(arguments[0]);default:throw Error(["Invalid arity: ",$APP.p.g(arguments.length)].join(""));}};JS.C=function(){return JS.g(null)};
JS.g=function(a){var b=function(){var d=$APP.MQ.g(a);return $APP.l(d)?d:0}(),c=esm_import$net.createServer(AFa);return c.listen(b,"127.0.0.1",function(){var d=c.address(),e=d.address;return $APP.Ov.l($APP.B([["Socket REPL listening on port ",$APP.p.g(d.port)," on host ",$APP.p.g(e)].join("")]))})};JS.A=1;var KS=function KS(a){switch(arguments.length){case 0:return KS.C();case 1:return KS.g(arguments[0]);default:throw Error(["Invalid arity: ",$APP.p.g(arguments.length)].join(""));}};KS.C=function(){return KS.g(null)};
KS.g=function(a){function b(e){return $APP.nCa(new $APP.E(null,$APP.Zj,new $APP.E(null,new $APP.E(null,$APP.Zj,new $APP.E(null,e,null,1,null),2,null),null,1,null),2,null))}$APP.l(GS)&&process.stdin.setRawMode(!0);var c=$APP.A.j($APP.KO,0,null),d=$APP.A.j($APP.KO,1,null);$APP.Ov.l($APP.B([["Welcome to nbb-logseq v",$APP.lu(),"!"].join("")]));return b(c).then(function(){return b(d)}).then(FFa.h(a,$APP.Ee)).then(function(){return new Promise(function(e){var f=$APP.l(null)?zFa(null):esm_import$readline.createInterface({input:process.stdin,
output:process.stdout,completer:tFa});yFa(f,null);f.setPrompt([$APP.p.g($APP.q(AS)),"\x3d\x3e "].join(""));f.on("close",e);return f.prompt()})})};KS.A=1;
var IFa=new $APP.k(null,3,[$APP.KQ,function(){var a=new $APP.hd(function(){return KS},CFa,$APP.Hh([$APP.S,$APP.O,$APP.ul,$APP.Rw,$APP.hI,$APP.mm,$APP.vl,$APP.UL,$APP.Z,$APP.N,$APP.FC],[HS,$APP.KQ,"nbb/impl/repl.cljs",11,new $APP.k(null,6,[$APP.ux,!1,$APP.Tr,1,$APP.AK,1,$APP.RJ,new $APP.H(null,2,5,$APP.I,[$APP.pg,new $APP.H(null,1,5,$APP.I,[$APP.qE],null)],null),$APP.Z,$APP.J($APP.pg,new $APP.H(null,1,5,$APP.I,[$APP.qE],null)),$APP.xC,$APP.J(null,null)],null),1,186,186,$APP.J($APP.pg,new $APP.H(null,
1,5,$APP.I,[$APP.qE],null)),null,$APP.l(KS)?KS.I:null])),b=$APP.q(a),c=$APP.Vd(a);a=$APP.l(null)?null:$APP.O.g(c);var d=new $APP.k(null,4,[$APP.S,IS,$APP.O,a,$APP.Z,$APP.Z.g(c),$APP.N,$APP.N.g(c)],null);return $APP.l($APP.Vp.g(c))?$APP.xO.j(a,b,d):$APP.l(function(){var e=$APP.np.g(c);return $APP.l(e)?e:$APP.Bp.g(c)}())?$APP.yO.j(a,b,d):$APP.kt.j(a,b,d)}(),GFa,function(){var a=new $APP.hd(function(){return BS},BFa,$APP.Hh([$APP.S,$APP.O,$APP.ul,$APP.Rw,$APP.mm,$APP.vl,$APP.UL,$APP.Z,$APP.N,$APP.FC],
[HS,DFa,"nbb/impl/repl.cljs",17,1,15,15,$APP.J(new $APP.H(null,1,5,$APP.I,[$APP.Sna],null)),"Given a line, returns a flat vector of completions",$APP.l(BS)?BS.I:null])),b=$APP.q(a),c=$APP.Vd(a);a=$APP.l(null)?null:$APP.O.g(c);var d=new $APP.k(null,4,[$APP.S,IS,$APP.O,a,$APP.Z,$APP.Z.g(c),$APP.N,$APP.N.g(c)],null);return $APP.l($APP.Vp.g(c))?$APP.xO.j(a,b,d):$APP.l(function(){var e=$APP.np.g(c);return $APP.l(e)?e:$APP.Bp.g(c)}())?$APP.yO.j(a,b,d):$APP.kt.j(a,b,d)}(),$APP.JQ,function(){var a=new $APP.hd(function(){return JS},
EFa,$APP.Hh([$APP.S,$APP.O,$APP.ul,$APP.Rw,$APP.hI,$APP.mm,$APP.vl,$APP.UL,$APP.Z,$APP.N,$APP.FC],[HS,$APP.JQ,"nbb/impl/repl.cljs",18,new $APP.k(null,6,[$APP.ux,!1,$APP.Tr,1,$APP.AK,1,$APP.RJ,new $APP.H(null,2,5,$APP.I,[$APP.pg,new $APP.H(null,1,5,$APP.I,[$APP.qE],null)],null),$APP.Z,$APP.J($APP.pg,new $APP.H(null,1,5,$APP.I,[$APP.qE],null)),$APP.xC,$APP.J(null,null)],null),1,171,171,$APP.J($APP.pg,new $APP.H(null,1,5,$APP.I,[$APP.qE],null)),null,$APP.l(JS)?JS.I:null])),b=$APP.q(a),c=$APP.Vd(a);a=
$APP.l(null)?null:$APP.O.g(c);var d=new $APP.k(null,4,[$APP.S,IS,$APP.O,a,$APP.Z,$APP.Z.g(c),$APP.N,$APP.N.g(c)],null);return $APP.l($APP.Vp.g(c))?$APP.xO.j(a,b,d):$APP.l(function(){var e=$APP.np.g(c);return $APP.l(e)?e:$APP.Bp.g(c)}())?$APP.yO.j(a,b,d):$APP.kt.j(a,b,d)}()],null);$APP.Zt(new $APP.k(null,1,[$APP.Kp,new $APP.k(null,1,[$APP.iw,IFa],null)],null));