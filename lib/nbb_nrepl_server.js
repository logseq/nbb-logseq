import { $APP, shadow$provide, $jscomp } from "./nbb_core.js";
import "./nbb_api.js";
import "./nbb_goog_string.js";
import "./nbb_pprint.js";
const shadow_esm_import = function(x) { return import(x) };
import*as esm_import$node_process from"node:process";import*as esm_import$node_net from"node:net";import*as esm_import$node_fs from"node:fs";import*as esm_import$node_path from"node:path";
var Neb=function(a,b){a=a.indexOf(b);if(0>a)throw Error("out of input");return a},S_=function(a,b){if(a.length<b)throw Error("out of input");return a.slice(b)},T_=function(a,b){if(b>a.length)throw Error("out of input");return a.slice(0,b)},Oeb=function(a){return(new TextEncoder).encode(a).length},U_=function(a){return $APP.k($APP.Eu.g($APP.n($APP.qN)))?console.debug($APP.on.h(" ",a)):null},Qeb=function(a){return function(b,c){b=$APP.Xf(b);var d=$APP.A.h(b,$APP.Gq),e=$APP.A.h(b,Peb);c=$APP.xi.j(c,
"id",d);c=$APP.k(e)?$APP.xi.j(c,"session",e):c;return a.h?a.h(b,c):a.call(null,b,c)}},Seb=function(){var a=Reb;return function(b,c){b=$APP.bn.j(b,$APP.eH,$APP.gj);return a.h?a.h(b,c):a.call(null,b,c)}},Ueb=function(){var a=Teb();return function(b,c){U_($APP.z(["request",b]));return a.h?a.h(b,c):a.call(null,b,c)}},Veb=function(a){return function(b,c){U_($APP.z(["response",c]));return a.h?a.h(b,c):a.call(null,b,c)}},Teb=function(){var a=Seb();return function(b,c){return a.h?a.h(b,c):a.call(null,b,c)}},
Web=function(a){return $APP.xi.j($APP.Ii(new $APP.H(null,3,5,$APP.J,["major","minor","incremental"],null),$APP.gz.g(a.split("."))),"version-string",a)},Yeb=function(a,b,c){if($APP.k(a))if(a=Xeb.g?Xeb.g(a):Xeb.call(null,a),$APP.k(a)){b=$APP.Xf(b);var d=$APP.A.h(b,$APP.ePa),e=$APP.A.h(b,$APP.JOa),f=$APP.A.h(b,$APP.UOa);b=$APP.qb;var m=$APP.$i,p=$APP.JP;$APP.qb=e;$APP.$i=f;$APP.JP=d;try{var u=new $APP.hb;d=$APP.sb;e=$APP.tb;$APP.sb=!0;$APP.tb=function(t){return u.append(t)};try{a.g?a.g(c):a.call(null,
c)}finally{$APP.tb=e,$APP.sb=d}return $APP.l.g(u)}finally{$APP.JP=p,$APP.$i=m,$APP.qb=b}}else return U_($APP.z(["Pretty-Printing is only supported for clojure.core/prn and clojure.pprint/pprint."])),$APP.xj.l($APP.z([c]));else return $APP.xj.l($APP.z([c]))},Zeb=function(a,b,c){$APP.gN.h($APP.RM,$APP.tg(c));var d=$APP.Jq.g($APP.fk(c));d=$APP.k(d)?d:c.message;$APP.k(d)&&(d=new $APP.h(null,1,["err",[$APP.l.g(d),"\n"].join("")],null),a.h?a.h(b,d):a.call(null,b,d));c=new $APP.h(null,2,["ex",$APP.l.g(c),
"ns",$APP.l.g($APP.n($APP.Nq))],null);return a.h?a.h(b,c):a.call(null,b,c)},dfb=function(a,b){var c=$APP.Xf(a),d=$APP.A.h(c,$APP.R);a=$APP.A.h(c,V_);var e=$APP.A.h(c,$APP.Sl);$APP.A.h(c,$eb);$APP.A.h(c,afb);var f=$APP.zp(a),m=function t(u){try{var B=function(){var E=$APP.R.g($APP.ie(u));if($APP.k(E))return E;E=$APP.n(W_);return $APP.k(E)?E:d}(),C=$APP.Wia(f,new $APP.h(null,3,[$APP.R,B,$APP.Sl,e,$APP.xI,$APP.Kw],null));return $APP.x.h($APP.qG,C)?Promise.resolve(u):$APP.sMa(C,new $APP.h(null,3,[$APP.R,
B,$APP.Sl,e,$APP.xI,$APP.Kw],null)).then(function(E){var I=$APP.y.j(E,0,null),P=$APP.y.j(E,1,null);P=$APP.R.g(P);$APP.vg(W_,P);$APP.gN.h($APP.QM,$APP.tg($APP.n($APP.PM)));$APP.gN.h($APP.PM,$APP.tg($APP.n($APP.OM)));$APP.gN.h($APP.OM,$APP.tg(I));I=Yeb(bfb.g(c),cfb.g(c),I);I=new $APP.h(null,2,["value",I,"ns",$APP.l.g(P)],null);b.h?b.h(c,I):b.call(null,c,I);return t(E)})}catch(E){return Zeb(b,c,E),t(null)}};$APP.bq($APP.Vf([$APP.Nq,d,$APP.wq,e,$APP.DL,$APP.n($APP.DL),$APP.IL,!0]));return function(){$APP.gN.h($APP.BL,
$APP.tg(function(u){u=new $APP.h(null,1,["out",u],null);return b.h?b.h(c,u):b.call(null,c,u)}));return m(null).catch($APP.Ml.j(Zeb,b,c)).finally(function(){var u=new $APP.h(null,2,["ns",$APP.l.g($APP.n(W_)),"status",new $APP.H(null,1,5,$APP.J,["done"],null)],null);return b.h?b.h(c,u):b.call(null,c,u)})}().finally(function(){return $APP.dq()})},efb=function(a,b){a=$APP.Xf(a);var c=$APP.A.h(a,$APP.R),d=$APP.xi.j;c=$APP.k(c)?$APP.xMa($APP.Fp(),$APP.lj.g(c)):null;$APP.k(c)||(c=$APP.n(W_),c=$APP.k(c)?
c:$APP.n($APP.Nq));return dfb(d.call($APP.xi,a,$APP.R,c),b)},gfb=function(a,b){var c=$APP.Xf(a),d=$APP.A.h(c,$APP.R),e=$APP.eH.g(c);try{var f=$APP.R.g(c),m=function(){var P=$APP.zE.g(c);return $APP.k(P)?P:$APP.Am.g(c)}(),p=function(){var P=$APP.k(d)?$APP.xMa($APP.Fp(),$APP.lj.g(d)):null;if($APP.k(P))return P;P=$APP.n(W_);return $APP.k(P)?P:$APP.n($APP.Nq)}(),u=$APP.Vf([$APP.Nq,p]);$APP.bq(u);try{var t=$APP.lu($APP.Fp(),$APP.YT("\n(let [ns '%s\n      full-sym '%s]\n  (when-let [v (ns-resolve ns full-sym)]\n    (let [m (meta v)]\n      (assoc m :arglists (:arglists m)\n       :doc (:doc m)\n       :name (:name m)\n       :ns (some-\x3e m :ns ns-name)\n       :val @v))))",
f,m)),B=$APP.N.g(t),C=$APP.Sl.g(t),E=$APP.Tl.g(t),I=function(){var P=e instanceof $APP.F?e.N:null;switch(P){case "eldoc":return P=new $APP.h(null,5,["ns",$APP.R.g(t),"name",$APP.Q.g(t),"eldoc",$APP.qn.h(function(S){return $APP.qn.h($APP.l,S)},$APP.W.g(t)),"type",$APP.Ne($APP.ou.g(t))?"function":"variable","status",new $APP.H(null,1,5,$APP.J,["done"],null)],null),$APP.k(B)?$APP.xi.j(P,"docstring",B):P;case "info":case "lookup":return P=new $APP.h(null,4,["ns",$APP.R.g(t),"name",$APP.Q.g(t),"arglists-str",
$APP.on.h("\n",$APP.fj.h($APP.xj,$APP.W.g(t))),"status",new $APP.H(null,1,5,$APP.J,["done"],null)],null),P=$APP.k(B)?$APP.xi.j(P,"doc",B):P,P=$APP.k(C)?$APP.xi.j(P,"file",C):P,$APP.k(E)?$APP.xi.j(P,"line",E):P;default:throw Error(["No matching clause: ",$APP.l.g(P)].join(""));}}();return b.h?b.h(c,I):b.call(null,c,I)}finally{$APP.dq()}}catch(P){if(P instanceof Error)return a=P,f=function(){var S=new $APP.Ai(null,new $APP.h(null,1,["done",null],null),null);return $APP.x.h(e,ffb)?$APP.xf.h(S,"no-eldoc"):
S}(),a=new $APP.h(null,2,["status",f,"ex",$APP.l.g(a)],null),b.h?b.h(c,a):b.call(null,c,a);throw P;}},Reb=function(a,b){a=$APP.Xf(a);var c=$APP.A.h(a,$APP.eH),d=$APP.A.h(hfb,c);if($APP.k(d))return d.h?d.h(a,b):d.call(null,a,b);console.warn($APP.on.h(" ",$APP.z(["Unhandled operation",c])));c=new $APP.h(null,1,["status",new $APP.H(null,3,5,$APP.J,["error","unknown-op","done"],null)],null);return b.h?b.h(a,c):b.call(null,a,c)},ifb=function(a){return function(b,c){return a.write(X_(c))}},jfb=function(a,
b){U_($APP.z(["Connection accepted"]));b.setNoDelay(!0);var c=Ueb(),d=Qeb(Veb(ifb(b))),e=$APP.zj.g(null);b.on("data",function(f){var m=$APP.n(e);if($APP.k(m)){f=[$APP.l.g(m),$APP.l.g(f)].join("");$APP.vg(e,null);var p=f}else p=f;a:for(f=$APP.z([$APP.hz,!0]),m=$APP.Sg;;){var u=$APP.qg.j(Y_,p,f);p=$APP.y.j(u,0,null);u=$APP.y.j(u,1,null);if(null==p){m=new $APP.H(null,2,5,$APP.J,[m,u],null);break a}m=$APP.xf.h(m,p);p=u}f=$APP.y.j(m,0,null);m=$APP.y.j(m,1,null);$APP.hl(m)||$APP.vg(e,m);f=$APP.r(f);m=null;
for(var t=u=0;;)if(t<u)p=m.ha(null,t),c(p,d),t+=1;else if(f=$APP.r(f))m=f,$APP.Fe(m)?(f=$APP.ed(m),u=$APP.fd(m),m=f,p=$APP.de(f),f=u,u=p):(p=$APP.v(m),c(p,d),f=$APP.w(m),m=null,u=0),t=0;else return null});return b.on("close",function(f){return $APP.k(f)?U_($APP.z(["Connection lost"])):U_($APP.z(["Connection closed"]))})},mfb=function(a){return Promise.resolve($APP.VO(esm_import$node_path.resolve("script.cljs"),null)).then(function(){function b(e){return $APP.pMa(new $APP.D(null,$APP.Ak,new $APP.D(null,
new $APP.D(null,$APP.Ak,new $APP.D(null,e,null,1,null),2,null),null,1,null),2,null))}var c=$APP.y.j($APP.rN,0,null),d=$APP.y.j($APP.rN,1,null);return b(c).then(function(){return b(d)})}).then(function(){var b=$APP.Kl.l($APP.z([$APP.n($APP.qN),a])),c=function(){var f=$APP.UF.g(b);return $APP.k(f)?f:0}(),d=function(){var f=$APP.eK.g(b);return $APP.k(f)?f:"127.0.0.1"}();(function(){var f=$APP.Eb(b)?b.Fo:kfb.g(b);return $APP.k(f)?f:"info"})();var e=esm_import$node_net.createServer($APP.Ml.h(jfb,$APP.Wf));
e.listen(c,d,function(){var f=e.address(),m=f.port;f=f.address;$APP.Wy.l($APP.z([["nREPL server started on port ",$APP.l.g(m)," on host ",$APP.l.g(f)," - nrepl://",$APP.l.g(f),":",$APP.l.g(m)].join("")]));$APP.gN.h($APP.IL,$APP.tg(!0));try{return esm_import$node_fs.writeFileSync(".nrepl-port",$APP.l.g(m))}catch(p){return console.warn($APP.on.h(" ",$APP.z(["Could not write .nrepl-port",p])))}});return $APP.vg(lfb,e)})},nfb=new $APP.q("nbb.impl.nrepl-server","stop-server!","nbb.impl.nrepl-server/stop-server!",
1628751782,null),cfb=new $APP.F("nrepl.middleware.print","options","nrepl.middleware.print/options",868480159),ofb=new $APP.q(null,"nbb.impl.nrepl-server","nbb.impl.nrepl-server",-1821079079,null),Peb=new $APP.F(null,"session","session",1008279103),pfb=new $APP.q("nbb.impl.nrepl-server","start-server!","nbb.impl.nrepl-server/start-server!",-2119141227,null),qfb=new $APP.F(null,"load-file","load-file",-424586670),V_=new $APP.F(null,"code","code",1586293142),kfb=new $APP.F(null,"log_level","log_level",
-1756736313),bfb=new $APP.F("nrepl.middleware.print","print","nrepl.middleware.print/print",-1616742548),rfb=new $APP.F(null,"clone","clone",711747572),sfb=new $APP.F(null,"close","close",1835149582),tfb=new $APP.F(null,"info","info",-317069002),ufb=new $APP.F(null,"macroexpand","macroexpand",-130598183),vfb=new $APP.F(null,"complete","complete",-500388775),afb=new $APP.F(null,"_line","_line",232847719),wfb=new $APP.q(null,"server","server",-1155245649,null),xfb=new $APP.F(null,"lookup","lookup",
1225356838),yfb=new $APP.F(null,"expander","expander",379138924),$eb=new $APP.F(null,"_load-file?","_load-file?",-1198848711),zfb=new $APP.F(null,"describe","describe",1369790582),ffb=new $APP.F(null,"eldoc","eldoc",-1321421900),Afb=new $APP.q(null,"stop-server!","stop-server!",-410772185,null),Bfb=new $APP.F(null,"load-file?","load-file?",1892536169);var Z_=function Z_(a,b){switch($APP.l.g(T_(a,1))){case "i":return a=S_(a,1),b=Neb(a,"e"),new $APP.H(null,2,5,$APP.J,[parseInt(T_(a,b)),S_(a,b+1)],null);case "l":var d=a=S_(a,1);for(a=$APP.Uc($APP.Sg);;){if($APP.x.h($APP.l.g(T_(d,1)),"e"))return new $APP.H(null,2,5,$APP.J,[$APP.Wc(a),S_(d,1)],null);var e=Z_.h?Z_.h(d,b):Z_.call(null,d,b),f=$APP.y.j(e,0,null),m=$APP.y.j(e,1,null);e=m;a=$APP.Rg.h(a,f);d=e}case "d":for(a=S_(a,1),f=$APP.Xf(b),f=$APP.A.h(f,$APP.hz),d=a,e=$APP.Uc($APP.Wf);;){if($APP.x.h($APP.l.g(T_(d,
1)),"e"))return new $APP.H(null,2,5,$APP.J,[$APP.Wc(e),S_(d,1)],null);a=Z_.h?Z_.h(d,b):Z_.call(null,d,b);d=$APP.y.j(a,0,null);m=$APP.y.j(a,1,null);m=Z_.h?Z_.h(m,b):Z_.call(null,m,b);a=$APP.y.j(m,0,null);m=$APP.y.j(m,1,null);d=$APP.k(f)?$APP.gj.g(d):d;a=$APP.Gh.j(e,d,a);d=m;e=a}default:return b=Neb(a,":"),f=parseInt(T_(a,b)),a=S_(a,b+1),new $APP.H(null,2,5,$APP.J,[$APP.l.g(T_(a,f)),S_(a,f)],null)}},Y_=function Y_(a){for(var c=[],d=arguments.length,e=0;;)if(e<d)c.push(arguments[e]),e+=1;else break;
return Y_.l(arguments[0],1<c.length?new $APP.Hd(c.slice(1),0,null):null)};Y_.l=function(a,b){try{return Z_(a,b)}catch(c){if(c instanceof Error)return new $APP.H(null,2,5,$APP.J,[null,a],null);throw c;}};Y_.B=1;Y_.G=function(a){var b=$APP.v(a);a=$APP.w(a);return this.l(b,a)};
var X_=function X_(a){for(;;){if("string"===typeof a)return[$APP.l.g(Oeb(a)),":",a].join("");if(a instanceof $APP.F||a instanceof $APP.q)a=[function(){var c=$APP.Cf(a);return $APP.k(c)?[c,"/"].join(""):null}(),$APP.Gi(a)].join("");else return"number"===typeof a?["i",$APP.l.g(a),"e"].join(""):$APP.ze(a)||$APP.Ee(a)||null==a?["l",$APP.l.g($APP.qg.h($APP.l,$APP.fj.h(X_,a))),"e"].join(""):$APP.Ce(a)?["d",$APP.l.g($APP.qg.h($APP.l,$APP.fj.h(function(){return function(c){var d=$APP.y.j(c,0,null);c=$APP.y.j(c,
1,null);return[$APP.l.g(X_.g?X_.g(d):X_.call(null,d)),$APP.l.g(X_.g?X_.g(c):X_.call(null,c))].join("")}}(a),$APP.Ox.h($APP.v,a)))),"e"].join(""):null}};var W_=$APP.zj.g(null),Xeb=new $APP.h(null,1,["cider.nrepl.pprint/pprint",$APP.pR],null),hfb=$APP.gi([$APP.WO,xfb,sfb,qfb,ffb,rfb,zfb,tfb,vfb,ufb,$APP.ZAa],[function(a,b){var c=new $APP.h(null,2,["status",new $APP.H(null,1,5,$APP.J,["done"],null),"classpath",$APP.fl.h($APP.Bp(),$APP.Zi(esm_import$node_path.delimiter))],null);return b.h?b.h(a,c):b.call(null,a,c)},gfb,function(a,b){var c=new $APP.h(null,1,["status",new $APP.H(null,1,5,$APP.J,["done"],null)],null);return b.h?b.h(a,c):b.call(null,a,c)},
function(a,b){a=$APP.Xf(a);var c=$APP.A.h(a,$APP.Sl);return dfb($APP.xi.l(a,V_,c,$APP.z([Bfb,!0,$APP.R,$APP.n($APP.Nq)])),b)},gfb,function(a,b){var c=new $APP.h(null,2,["new-session",$APP.l.g($APP.dk()),"status",new $APP.H(null,1,5,$APP.J,["done"],null)],null);return b.h?b.h(a,c):b.call(null,a,c)},function(a,b){var c=new $APP.h(null,4,["versions",new $APP.h(null,2,["nbb-nrepl",Web("TODO"),"node",Web(esm_import$node_process.version)],null),"aux",$APP.Wf,"ops",$APP.Ii($APP.fj.h($APP.Gi,$APP.ti(hfb)),
$APP.kn.g($APP.Wf)),"status",new $APP.H(null,1,5,$APP.J,["done"],null)],null);return b.h?b.h(a,c):b.call(null,a,c)},gfb,function(a,b){var c=$APP.DMa(a);return b.h?b.h(a,c):b.call(null,a,c)},function(a,b){a=$APP.Xf(a);var c=$APP.A.h(a,V_),d=$APP.A.h(a,yfb);try{return efb($APP.xi.j(a,V_,["( ",$APP.l.g(d),"(quote ",$APP.l.g(c),"))"].join("")),function(e,f){var m=f.g?f.g("value"):f.call(null,"value");f=$APP.k(m)?$APP.xi.j(f,"expansion",m):f;return b.h?b.h(e,f):b.call(null,e,f)})}catch(e){if(e instanceof
Error)return c=new $APP.h(null,3,["ex",$APP.l.g(e),"ns",$APP.l.g($APP.n($APP.Nq)),"status",new $APP.H(null,1,5,$APP.J,["done"],null)],null),b.h?b.h(a,c):b.call(null,a,c);throw e;}},efb]),lfb=$APP.zj.g(null),$_=function $_(a){switch(arguments.length){case 0:return $_.D();case 1:return $_.g(arguments[0]);default:throw Error(["Invalid arity: ",$APP.l.g(arguments.length)].join(""));}};$_.D=function(){return $_.g($APP.n(lfb))};
$_.g=function(a){return a.close(function(){$APP.gN.h($APP.BL,$APP.tg($APP.tb));$APP.gN.h($APP.IL,$APP.tg($APP.sb));return $APP.k(esm_import$node_fs.existsSync(".nrepl-port"))?esm_import$node_fs.unlinkSync(".nrepl-port"):null})};$_.B=1;
var Cfb=$APP.kN.h($APP.lA,null),Dfb=new $APP.h(null,2,[$APP.GMa,function(){var a=new $APP.Ed(function(){return mfb},pfb,$APP.gi([$APP.R,$APP.Q,$APP.Sl,$APP.$z,$APP.Pm,$APP.Tl,$APP.CK,$APP.W,$APP.N,$APP.iF],[$APP.te(ofb,new $APP.h(null,1,[$APP.N,"Original implementation taken from https://github.com/viesti/nrepl-cljs-sci."],null)),$APP.GMa,"nbb/impl/nrepl_server.cljs",20,1,327,327,$APP.K(new $APP.H(null,1,5,$APP.J,[$APP.ZF],null)),"Start nRepl server. Accepts options either as JS object or Clojure map.",
$APP.k(mfb)?mfb.H:null])),b=$APP.n(a),c=$APP.ue(a);a=$APP.k(null)?null:$APP.Q.g(c);var d=new $APP.h(null,4,[$APP.R,Cfb,$APP.Q,a,$APP.W,$APP.W.g(c),$APP.N,$APP.N.g(c)],null);return $APP.k($APP.Uq.g(c))?$APP.eN.j(a,b,d):$APP.k(function(){var e=$APP.oq.g(c);return $APP.k(e)?e:$APP.yq.g(c)}())?$APP.fN.j(a,b,d):$APP.nu.j(a,b,d)}(),Afb,function(){var a=new $APP.Ed(function(){return $_},nfb,$APP.gi([$APP.R,$APP.Q,$APP.Sl,$APP.$z,$APP.lI,$APP.Pm,$APP.Tl,$APP.CK,$APP.W,$APP.N,$APP.iF],[$APP.te(ofb,new $APP.h(null,
1,[$APP.N,"Original implementation taken from https://github.com/viesti/nrepl-cljs-sci."],null)),Afb,"nbb/impl/nrepl_server.cljs",19,new $APP.h(null,6,[$APP.FA,!1,$APP.Rs,1,$APP.zJ,1,$APP.hJ,new $APP.H(null,2,5,$APP.J,[$APP.Sg,new $APP.H(null,1,5,$APP.J,[wfb],null)],null),$APP.W,$APP.K($APP.Sg,new $APP.H(null,1,5,$APP.J,[wfb],null)),$APP.dF,$APP.K(null,null)],null),1,398,398,$APP.K($APP.Sg,new $APP.H(null,1,5,$APP.J,[wfb],null)),null,$APP.k($_)?$_.H:null])),b=$APP.n(a),c=$APP.ue(a);a=$APP.k(null)?
null:$APP.Q.g(c);var d=new $APP.h(null,4,[$APP.R,Cfb,$APP.Q,a,$APP.W,$APP.W.g(c),$APP.N,$APP.N.g(c)],null);return $APP.k($APP.Uq.g(c))?$APP.eN.j(a,b,d):$APP.k(function(){var e=$APP.oq.g(c);return $APP.k(e)?e:$APP.yq.g(c)}())?$APP.fN.j(a,b,d):$APP.nu.j(a,b,d)}()],null);$APP.$u(new $APP.h(null,1,[$APP.Kq,new $APP.h(null,1,[$APP.lA,Dfb],null)],null));