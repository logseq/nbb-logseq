import { $APP, shadow$provide, $jscomp } from "./nbb_core.js";
import "./nbb_api.js";
import "./nbb_goog_string.js";
import "./nbb_pprint.js";
const shadow_esm_import = function(x) { return import(x) };
import*as esm_import$fs from"fs";import*as esm_import$net from"net";import*as esm_import$path from"path";
var YNa=function(a,b){a=a.indexOf(b);if(0>a)throw Error("out of input");return a},XX=function(a,b){if(a.length<b)throw Error("out of input");return a.slice(b)},YX=function(a,b){if(b>a.length)throw Error("out of input");return a.slice(0,b)},ZX=function(a){return $APP.l($APP.Bt.g($APP.q($APP.JO)))?console.debug($APP.Mm.h(" ",a)):null},$Na=function(a){return function(b,c){b=$APP.xf(b);var d=$APP.C.h(b,$APP.Gp),e=$APP.C.h(b,ZNa);c=$APP.Zh.j(c,"id",d);c=$APP.l(e)?$APP.Zh.j(c,"session",e):c;return a.h?
a.h(b,c):a.call(null,b,c)}},bOa=function(){var a=aOa;return function(b,c){b=$APP.ym.j(b,$APP.oG,$APP.Hi);return a.h?a.h(b,c):a.call(null,b,c)}},dOa=function(){var a=cOa();return function(b,c){ZX($APP.B(["request",b]));return a.h?a.h(b,c):a.call(null,b,c)}},eOa=function(a){return function(b,c){ZX($APP.B(["response",c]));return a.h?a.h(b,c):a.call(null,b,c)}},cOa=function(){var a=bOa();return function(b,c){return a.h?a.h(b,c):a.call(null,b,c)}},fOa=function(a){return $APP.Zh.j($APP.ii(new $APP.H(null,
3,5,$APP.I,["major","minor","incremental"],null),$APP.Zv.g(a.split("."))),"version-string",a)},gOa=function(a,b,c){if($APP.l(a))if(a=$X.g?$X.g(a):$X.call(null,a),$APP.l(a)){b=$APP.xf(b);var d=$APP.C.h(b,$APP.ANa),e=$APP.C.h(b,$APP.wX),f=$APP.C.h(b,$APP.yX);b=$APP.Xa;var h=$APP.zi,m=$APP.OV;$APP.Xa=e;$APP.zi=f;$APP.OV=d;try{var r=new $APP.Oa;d=$APP.$a;e=$APP.bb;$APP.$a=!0;$APP.bb=function(n){return r.append(n)};try{a.g?a.g(c):a.call(null,c)}finally{$APP.bb=e,$APP.$a=d}return $APP.p.g(r)}finally{$APP.OV=
m,$APP.zi=h,$APP.Xa=b}}else return ZX($APP.B(["Pretty-Printing is only supported for clojure.core/prn and clojure.pprint/pprint."])),$APP.aj.l($APP.B([c]));else return $APP.aj.l($APP.B([c]))},hOa=function(a,b,c){$APP.zO.h($APP.hO,$APP.Xf(c));var d=$APP.Jp.g($APP.Hj(c));d=$APP.l(d)?d:c.message;$APP.l(d)&&(d=new $APP.k(null,1,["err",[$APP.p.g(d),"\n"].join("")],null),a.h?a.h(b,d):a.call(null,b,d));c=new $APP.k(null,2,["ex",$APP.p.g(c),"ns",$APP.p.g($APP.q($APP.Np))],null);return a.h?a.h(b,c):a.call(null,
b,c)},mOa=function(a,b){var c=$APP.xf(a),d=$APP.C.h(c,$APP.S);a=$APP.C.h(c,aY);var e=$APP.C.h(c,$APP.ul);$APP.C.h(c,iOa);$APP.C.h(c,jOa);var f=$APP.Bo(a),h=function n(r){try{var w=function(){var D=$APP.S.g($APP.Kd(r));if($APP.l(D))return D;D=$APP.q(bY);return $APP.l(D)?D:d}(),x=$APP.Gka(f,new $APP.k(null,3,[$APP.S,w,$APP.ul,e,$APP.JI,$APP.qv],null));return $APP.z.h($APP.ME,x)?Promise.resolve(r):$APP.pCa(x,new $APP.k(null,3,[$APP.S,w,$APP.ul,e,$APP.JI,$APP.qv],null)).then(function(D){var G=$APP.A.j(D,
0,null),M=$APP.A.j(D,1,null);M=$APP.S.g(M);$APP.Zf(bY,M);$APP.zO.h($APP.gO,$APP.Xf($APP.q($APP.fO)));$APP.zO.h($APP.fO,$APP.Xf($APP.q($APP.eO)));$APP.zO.h($APP.eO,$APP.Xf(G));G=gOa(kOa.g(c),lOa.g(c),G);G=new $APP.k(null,2,["value",G,"ns",$APP.p.g(M)],null);b.h?b.h(c,G):b.call(null,c,G);return n(D)})}catch(D){return hOa(b,c,D),n(null)}};$APP.bp($APP.vf([$APP.Np,d,$APP.zp,e,$APP.WM,$APP.q($APP.WM),$APP.aN,!0]));return function(){$APP.zO.h($APP.UM,$APP.Xf(function(r){r=new $APP.k(null,1,["out",r],null);
return b.h?b.h(c,r):b.call(null,c,r)}));return h(null).catch($APP.ol.j(hOa,b,c)).finally(function(){var r=new $APP.k(null,2,["ns",$APP.p.g($APP.q(bY)),"status",new $APP.H(null,1,5,$APP.I,["done"],null)],null);return b.h?b.h(c,r):b.call(null,c,r)})}().finally(function(){return $APP.dp()})},nOa=function(a,b){a=$APP.xf(a);var c=$APP.C.h(a,$APP.S),d=$APP.Zh.j;c=$APP.l(c)?$APP.GQ($APP.Et(),$APP.Mi.g(c)):null;$APP.l(c)||(c=$APP.q(bY),c=$APP.l(c)?c:$APP.q($APP.Np));return mOa(d.call($APP.Zh,a,$APP.S,c),
b)},cY=function(a,b){var c=$APP.xf(a),d=$APP.C.h(c,$APP.S),e=$APP.oG.g(c);try{var f=$APP.S.g(c),h=function(){var M=$APP.Soa.g(c);return $APP.l(M)?M:$APP.am.g(c)}(),m=function(){var M=$APP.l(d)?$APP.GQ($APP.Et(),$APP.Mi.g(d)):null;if($APP.l(M))return M;M=$APP.q(bY);return $APP.l(M)?M:$APP.q($APP.Np)}(),r=$APP.vf([$APP.Np,m]);$APP.bp(r);try{var n=$APP.ht($APP.Et(),$APP.VU("\n(let [ns '%s\n      full-sym '%s]\n  (when-let [v (ns-resolve ns full-sym)]\n    (let [m (meta v)]\n      (assoc m :arglists (:arglists m)\n       :doc (:doc m)\n       :name (:name m)\n       :ns (some-\x3e m :ns ns-name)\n       :val @v))))",
f,h)),w=$APP.N.g(n),x=$APP.ul.g(n),D=$APP.vl.g(n),G=function(){var M=e instanceof $APP.F?e.S:null;switch(M){case "eldoc":return M=new $APP.k(null,5,["ns",$APP.S.g(n),"name",$APP.O.g(n),"eldoc",$APP.Om.h(function(U){return $APP.Om.h($APP.p,U)},$APP.Z.g(n)),"type",$APP.ne($APP.lt.g(n))?"function":"variable","status",new $APP.H(null,1,5,$APP.I,["done"],null)],null),$APP.l(w)?$APP.Zh.j(M,"docstring",w):M;case "info":case "lookup":return M=new $APP.k(null,4,["ns",$APP.S.g(n),"name",$APP.O.g(n),"arglists-str",
$APP.Mm.h("\n",$APP.Gi.h($APP.aj,$APP.Z.g(n))),"status",new $APP.H(null,1,5,$APP.I,["done"],null)],null),M=$APP.l(w)?$APP.Zh.j(M,"doc",w):M,M=$APP.l(x)?$APP.Zh.j(M,"file",x):M,$APP.l(D)?$APP.Zh.j(M,"line",D):M;default:throw Error(["No matching clause: ",$APP.p.g(M)].join(""));}}();return b.h?b.h(c,G):b.call(null,c,G)}finally{$APP.dp()}}catch(M){if(M instanceof Error)return a=M,f=function(){var U=new $APP.bi(null,new $APP.k(null,1,["done",null],null),null);return $APP.z.h(e,oOa)?$APP.Ve.h(U,"no-eldoc"):
U}(),a=new $APP.k(null,2,["status",f,"ex",$APP.p.g(a)],null),b.h?b.h(c,a):b.call(null,c,a);throw M;}},aOa=function(a,b){a=$APP.xf(a);var c=$APP.C.h(a,$APP.oG),d=$APP.C.h(pOa,c);if($APP.l(d))return d.h?d.h(a,b):d.call(null,a,b);console.warn($APP.Mm.h(" ",$APP.B(["Unhandled operation",c])));c=new $APP.k(null,1,["status",new $APP.H(null,3,5,$APP.I,["error","unknown-op","done"],null)],null);return b.h?b.h(a,c):b.call(null,a,c)},qOa=function(a){return function(b,c){return a.write(dY(c))}},rOa=function(a,
b){ZX($APP.B(["Connection accepted"]));b.setNoDelay(!0);var c=dOa(),d=$Na(eOa(qOa(b))),e=$APP.cj.g(null);b.on("data",function(f){var h=$APP.q(e);if($APP.l(h)){f=[$APP.p.g(h),$APP.p.g(f)].join("");$APP.Zf(e,null);var m=f}else m=f;a:for(f=$APP.B([$APP.$v,!0]),h=$APP.pg;;){var r=$APP.Vf.j(eY,m,f);m=$APP.A.j(r,0,null);r=$APP.A.j(r,1,null);if(null==m){h=new $APP.H(null,2,5,$APP.I,[h,r],null);break a}h=$APP.Ve.h(h,m);m=r}f=$APP.A.j(h,0,null);h=$APP.A.j(h,1,null);$APP.Jk(h)||$APP.Zf(e,h);f=$APP.u(f);h=null;
for(var n=r=0;;)if(n<r)m=h.ea(null,n),c(m,d),n+=1;else if(f=$APP.u(f))h=f,$APP.he(h)?(f=$APP.Kc(h),r=$APP.Lc(h),h=f,m=$APP.Fd(f),f=r,r=m):(m=$APP.v(h),c(m,d),f=$APP.y(h),h=null,r=0),n=0;else return null});return b.on("close",function(f){return $APP.l(f)?ZX($APP.B(["Connection lost"])):ZX($APP.B(["Connection closed"]))})},fY=function(a){return Promise.resolve($APP.FQ(esm_import$path.resolve("script.cljs"),null)).then(function(){function b(e){return $APP.nCa(new $APP.E(null,$APP.Zj,new $APP.E(null,
new $APP.E(null,$APP.Zj,new $APP.E(null,e,null,1,null),2,null),null,1,null),2,null))}var c=$APP.A.j($APP.KO,0,null),d=$APP.A.j($APP.KO,1,null);return b(c).then(function(){return b(d)})}).then(function(){var b=$APP.ml.l($APP.B([$APP.q($APP.JO),a])),c=function(){var f=$APP.MQ.g(b);return $APP.l(f)?f:0}(),d=function(){var f=$APP.yCa.g(b);return $APP.l(f)?f:"127.0.0.1"}();(function(){var f=$APP.lb(b)?b.Jl:sOa.g(b);return $APP.l(f)?f:"info"})();var e=esm_import$net.createServer($APP.ol.h(rOa,$APP.wf));
e.listen(c,d,function(){var f=e.address(),h=f.port;f=f.address;$APP.Ov.l($APP.B([["nREPL server started on port ",$APP.p.g(h)," on host ",$APP.p.g(f)," - nrepl://",$APP.p.g(f),":",$APP.p.g(h)].join("")]));$APP.zO.h($APP.aN,$APP.Xf(!0));try{return esm_import$fs.writeFileSync(".nrepl-port",$APP.p.g(h))}catch(m){return console.warn($APP.Mm.h(" ",$APP.B(["Could not write .nrepl-port",m])))}});return $APP.Zf(tOa,e)})},uOa=new $APP.t("nbb.impl.nrepl-server","stop-server!","nbb.impl.nrepl-server/stop-server!",
1628751782,null),lOa=new $APP.F("nrepl.middleware.print","options","nrepl.middleware.print/options",868480159),vOa=new $APP.t(null,"nbb.impl.nrepl-server","nbb.impl.nrepl-server",-1821079079,null),ZNa=new $APP.F(null,"session","session",1008279103),wOa=new $APP.t("nbb.impl.nrepl-server","start-server!","nbb.impl.nrepl-server/start-server!",-2119141227,null),xOa=new $APP.F(null,"load-file","load-file",-424586670),aY=new $APP.F(null,"code","code",1586293142),sOa=new $APP.F(null,"log_level","log_level",
-1756736313),kOa=new $APP.F("nrepl.middleware.print","print","nrepl.middleware.print/print",-1616742548),yOa=new $APP.F(null,"clone","clone",711747572),zOa=new $APP.F(null,"close","close",1835149582),AOa=new $APP.F(null,"info","info",-317069002),BOa=new $APP.F(null,"macroexpand","macroexpand",-130598183),COa=new $APP.F(null,"complete","complete",-500388775),jOa=new $APP.F(null,"_line","_line",232847719),gY=new $APP.t(null,"server","server",-1155245649,null),DOa=new $APP.F(null,"lookup","lookup",1225356838),
EOa=new $APP.F(null,"expander","expander",379138924),iOa=new $APP.F(null,"_load-file?","_load-file?",-1198848711),FOa=new $APP.F(null,"describe","describe",1369790582),oOa=new $APP.F(null,"eldoc","eldoc",-1321421900),GOa=new $APP.t(null,"stop-server!","stop-server!",-410772185,null),HOa=new $APP.F(null,"load-file?","load-file?",1892536169);var hY=function hY(a,b){switch($APP.p.g(YX(a,1))){case "i":return a=XX(a,1),b=YNa(a,"e"),new $APP.H(null,2,5,$APP.I,[parseInt(YX(a,b)),XX(a,b+1)],null);case "l":var d=a=XX(a,1);for(a=$APP.zc($APP.pg);;){if($APP.z.h($APP.p.g(YX(d,1)),"e"))return new $APP.H(null,2,5,$APP.I,[$APP.Bc(a),XX(d,1)],null);var e=hY.h?hY.h(d,b):hY.call(null,d,b),f=$APP.A.j(e,0,null),h=$APP.A.j(e,1,null);e=h;a=$APP.og.h(a,f);d=e}case "d":for(a=XX(a,1),f=$APP.xf(b),f=$APP.C.h(f,$APP.$v),d=a,e=$APP.zc($APP.wf);;){if($APP.z.h($APP.p.g(YX(d,
1)),"e"))return new $APP.H(null,2,5,$APP.I,[$APP.Bc(e),XX(d,1)],null);a=hY.h?hY.h(d,b):hY.call(null,d,b);d=$APP.A.j(a,0,null);h=$APP.A.j(a,1,null);h=hY.h?hY.h(h,b):hY.call(null,h,b);a=$APP.A.j(h,0,null);h=$APP.A.j(h,1,null);d=$APP.l(f)?$APP.Hi.g(d):d;a=$APP.hh.j(e,d,a);d=h;e=a}default:return b=YNa(a,":"),f=parseInt(YX(a,b)),a=XX(a,b+1),new $APP.H(null,2,5,$APP.I,[$APP.p.g(YX(a,f)),XX(a,f)],null)}},eY=function eY(a){for(var c=[],d=arguments.length,e=0;;)if(e<d)c.push(arguments[e]),e+=1;else break;
return eY.l(arguments[0],1<c.length?new $APP.jd(c.slice(1),0,null):null)};eY.l=function(a,b){try{return hY(a,b)}catch(c){if(c instanceof Error)return new $APP.H(null,2,5,$APP.I,[null,a],null);throw c;}};eY.A=1;eY.F=function(a){var b=$APP.v(a);a=$APP.y(a);return this.l(b,a)};
var dY=function dY(a){for(;;){if("string"===typeof a)return[$APP.p.g(Buffer.from(a).length),":",a].join("");if(a instanceof $APP.F||a instanceof $APP.t)a=[function(){var c=$APP.af(a);return $APP.l(c)?[c,"/"].join(""):null}(),$APP.hi(a)].join("");else return"number"===typeof a?["i",$APP.p.g(a),"e"].join(""):$APP.ae(a)||$APP.ge(a)||null==a?["l",$APP.p.g($APP.Vf.h($APP.p,$APP.Gi.h(dY,a))),"e"].join(""):$APP.ce(a)?["d",$APP.p.g($APP.Vf.h($APP.p,$APP.Gi.h(function(){return function(c){var d=$APP.A.j(c,
0,null);c=$APP.A.j(c,1,null);return[$APP.p.g(dY.g?dY.g(d):dY.call(null,d)),$APP.p.g(dY.g?dY.g(c):dY.call(null,c))].join("")}}(a),$APP.Gu.h($APP.v,a)))),"e"].join(""):null}};var bY=$APP.cj.g(null),$X=new $APP.k(null,1,["cider.nrepl.pprint/pprint",$APP.JX],null),pOa=$APP.Hh([$APP.NQ,DOa,zOa,xOa,oOa,yOa,FOa,AOa,COa,BOa,$APP.Sta],[function(a,b){var c=new $APP.k(null,2,["status",new $APP.H(null,1,5,$APP.I,["done"],null),"classpath",$APP.Hk.h($APP.Do(),$APP.yi(esm_import$path.delimiter))],null);return b.h?b.h(a,c):b.call(null,a,c)},cY,function(a,b){var c=new $APP.k(null,1,["status",new $APP.H(null,1,5,$APP.I,["done"],null)],null);return b.h?b.h(a,c):b.call(null,a,c)},function(a,
b){a=$APP.xf(a);var c=$APP.C.h(a,$APP.ul);return mOa($APP.Zh.l(a,aY,c,$APP.B([HOa,!0,$APP.S,$APP.q($APP.Np)])),b)},cY,function(a,b){var c=new $APP.k(null,2,["new-session",$APP.p.g($APP.Fj()),"status",new $APP.H(null,1,5,$APP.I,["done"],null)],null);return b.h?b.h(a,c):b.call(null,a,c)},function(a,b){var c=new $APP.k(null,4,["versions",new $APP.k(null,2,["nbb-nrepl",fOa("TODO"),"node",fOa(process.version)],null),"aux",$APP.wf,"ops",$APP.ii($APP.Gi.h($APP.hi,$APP.Vh(pOa)),$APP.Jm.g($APP.wf)),"status",
new $APP.H(null,1,5,$APP.I,["done"],null)],null);return b.h?b.h(a,c):b.call(null,a,c)},cY,function(a,b){var c=$APP.xCa(a);return b.h?b.h(a,c):b.call(null,a,c)},function(a,b){a=$APP.xf(a);var c=$APP.C.h(a,aY),d=$APP.C.h(a,EOa);try{return nOa($APP.Zh.j(a,aY,["( ",$APP.p.g(d),"(quote ",$APP.p.g(c),"))"].join("")),function(e,f){var h=f.g?f.g("value"):f.call(null,"value");f=$APP.l(h)?$APP.Zh.j(f,"expansion",h):f;return b.h?b.h(e,f):b.call(null,e,f)})}catch(e){if(e instanceof Error)return c=new $APP.k(null,
3,["ex",$APP.p.g(e),"ns",$APP.p.g($APP.q($APP.Np)),"status",new $APP.H(null,1,5,$APP.I,["done"],null)],null),b.h?b.h(a,c):b.call(null,a,c);throw e;}},nOa]),tOa=$APP.cj.g(null),jY=function jY(a){switch(arguments.length){case 0:return jY.C();case 1:return jY.g(arguments[0]);default:throw Error(["Invalid arity: ",$APP.p.g(arguments.length)].join(""));}};jY.C=function(){return jY.g($APP.q(tOa))};
jY.g=function(a){return a.close(function(){$APP.zO.h($APP.UM,$APP.Xf($APP.bb));$APP.zO.h($APP.aN,$APP.Xf($APP.$a));return $APP.l(esm_import$fs.existsSync(".nrepl-port"))?esm_import$fs.unlinkSync(".nrepl-port"):null})};jY.A=1;
var IOa=$APP.DO.h($APP.cx,null),JOa=new $APP.k(null,2,[$APP.LQ,function(){var a=new $APP.hd(function(){return fY},wOa,$APP.Hh([$APP.S,$APP.O,$APP.ul,$APP.Rw,$APP.mm,$APP.vl,$APP.UL,$APP.Z,$APP.N,$APP.FC],[$APP.Ud(vOa,new $APP.k(null,1,[$APP.N,"Original implementation taken from https://github.com/viesti/nrepl-cljs-sci."],null)),$APP.LQ,"nbb/impl/nrepl_server.cljs",20,1,326,326,$APP.J(new $APP.H(null,1,5,$APP.I,[$APP.qE],null)),"Start nRepl server. Accepts options either as JS object or Clojure map.",
$APP.l(fY)?fY.I:null])),b=$APP.q(a),c=$APP.Vd(a);a=$APP.l(null)?null:$APP.O.g(c);var d=new $APP.k(null,4,[$APP.S,IOa,$APP.O,a,$APP.Z,$APP.Z.g(c),$APP.N,$APP.N.g(c)],null);return $APP.l($APP.Vp.g(c))?$APP.xO.j(a,b,d):$APP.l(function(){var e=$APP.np.g(c);return $APP.l(e)?e:$APP.Bp.g(c)}())?$APP.yO.j(a,b,d):$APP.kt.j(a,b,d)}(),GOa,function(){var a=new $APP.hd(function(){return jY},uOa,$APP.Hh([$APP.S,$APP.O,$APP.ul,$APP.Rw,$APP.hI,$APP.mm,$APP.vl,$APP.UL,$APP.Z,$APP.N,$APP.FC],[$APP.Ud(vOa,new $APP.k(null,
1,[$APP.N,"Original implementation taken from https://github.com/viesti/nrepl-cljs-sci."],null)),GOa,"nbb/impl/nrepl_server.cljs",19,new $APP.k(null,6,[$APP.ux,!1,$APP.Tr,1,$APP.AK,1,$APP.RJ,new $APP.H(null,2,5,$APP.I,[$APP.pg,new $APP.H(null,1,5,$APP.I,[gY],null)],null),$APP.Z,$APP.J($APP.pg,new $APP.H(null,1,5,$APP.I,[gY],null)),$APP.xC,$APP.J(null,null)],null),1,397,397,$APP.J($APP.pg,new $APP.H(null,1,5,$APP.I,[gY],null)),null,$APP.l(jY)?jY.I:null])),b=$APP.q(a),c=$APP.Vd(a);a=$APP.l(null)?null:
$APP.O.g(c);var d=new $APP.k(null,4,[$APP.S,IOa,$APP.O,a,$APP.Z,$APP.Z.g(c),$APP.N,$APP.N.g(c)],null);return $APP.l($APP.Vp.g(c))?$APP.xO.j(a,b,d):$APP.l(function(){var e=$APP.np.g(c);return $APP.l(e)?e:$APP.Bp.g(c)}())?$APP.yO.j(a,b,d):$APP.kt.j(a,b,d)}()],null);$APP.Zt(new $APP.k(null,1,[$APP.Kp,new $APP.k(null,1,[$APP.cx,JOa],null)],null));