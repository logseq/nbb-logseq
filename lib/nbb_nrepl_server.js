import { $APP, shadow$provide, $jscomp } from "./nbb_core.js";
import "./nbb_api.js";
import "./nbb_goog_string.js";
import "./nbb_pprint.js";
const shadow_esm_import = function(x) { return import(x) };
import*as esm_import$fs from"fs";import*as esm_import$net from"net";import*as esm_import$path from"path";
var QNa=function(a,b){a=a.indexOf(b);if(0>a)throw Error("out of input");return a},eY=function(a,b){if(a.length<b)throw Error("out of input");return a.slice(b)},fY=function(a,b){if(b>a.length)throw Error("out of input");return a.slice(0,b)},gY=function(a){return $APP.l($APP.Ct.g($APP.q($APP.MO)))?console.debug($APP.Om.h(" ",a)):null},SNa=function(a){return function(b,c){b=$APP.xf(b);var d=$APP.D.h(b,$APP.Ip),e=$APP.D.h(b,RNa);c=$APP.$h.j(c,"id",d);c=$APP.l(e)?$APP.$h.j(c,"session",e):c;return a.h?
a.h(b,c):a.call(null,b,c)}},UNa=function(){var a=TNa;return function(b,c){b=$APP.Am.j(b,$APP.qG,$APP.Ji);return a.h?a.h(b,c):a.call(null,b,c)}},WNa=function(){var a=VNa();return function(b,c){gY($APP.C(["request",b]));return a.h?a.h(b,c):a.call(null,b,c)}},XNa=function(a){return function(b,c){gY($APP.C(["response",c]));return a.h?a.h(b,c):a.call(null,b,c)}},VNa=function(){var a=UNa();return function(b,c){return a.h?a.h(b,c):a.call(null,b,c)}},YNa=function(a){return $APP.$h.j($APP.ki(new $APP.H(null,
3,5,$APP.I,["major","minor","incremental"],null),$APP.$v.g(a.split("."))),"version-string",a)},ZNa=function(a,b,c){if($APP.l(a))if(a=hY.g?hY.g(a):hY.call(null,a),$APP.l(a)){b=$APP.xf(b);var d=$APP.D.h(b,$APP.sNa),e=$APP.D.h(b,$APP.EX),f=$APP.D.h(b,$APP.GX);b=$APP.Xa;var h=$APP.Bi,m=$APP.WV;$APP.Xa=e;$APP.Bi=f;$APP.WV=d;try{var r=new $APP.Oa;d=$APP.Za;e=$APP.ab;$APP.Za=!0;$APP.ab=function(n){return r.append(n)};try{a.g?a.g(c):a.call(null,c)}finally{$APP.ab=e,$APP.Za=d}return $APP.p.g(r)}finally{$APP.WV=
m,$APP.Bi=h,$APP.Xa=b}}else return gY($APP.C(["Pretty-Printing is only supported for clojure.core/prn and clojure.pprint/pprint."])),$APP.aj.l($APP.C([c]));else return $APP.aj.l($APP.C([c]))},$Na=function(a,b,c){$APP.CO.h($APP.kO,$APP.Zf(c));var d=$APP.Lp.g($APP.Hj(c));d=$APP.l(d)?d:c.message;$APP.l(d)&&(d=new $APP.k(null,1,["err",[$APP.p.g(d),"\n"].join("")],null),a.h?a.h(b,d):a.call(null,b,d));c=new $APP.k(null,2,["ex",$APP.p.g(c),"ns",$APP.p.g($APP.q($APP.Pp))],null);return a.h?a.h(b,c):a.call(null,
b,c)},eOa=function(a,b){var c=$APP.xf(a),d=$APP.D.h(c,$APP.S);a=$APP.D.h(c,iY);var e=$APP.D.h(c,$APP.xl);$APP.D.h(c,aOa);$APP.D.h(c,bOa);var f=$APP.Do(a),h=function n(r){try{var w=function(){var B=$APP.S.g($APP.Md(r));if($APP.l(B))return B;B=$APP.q(jY);return $APP.l(B)?B:d}(),x=$APP.zka(f,new $APP.k(null,3,[$APP.S,w,$APP.xl,e,$APP.LI,$APP.rv],null));return $APP.z.h($APP.OE,x)?Promise.resolve(r):$APP.hCa(x,new $APP.k(null,3,[$APP.S,w,$APP.xl,e,$APP.LI,$APP.rv],null)).then(function(B){var F=$APP.A.j(B,
0,null),M=$APP.A.j(B,1,null);M=$APP.S.g(M);$APP.ag(jY,M);$APP.CO.h($APP.jO,$APP.Zf($APP.q($APP.iO)));$APP.CO.h($APP.iO,$APP.Zf($APP.q($APP.hO)));$APP.CO.h($APP.hO,$APP.Zf(F));F=ZNa(cOa.g(c),dOa.g(c),F);F=new $APP.k(null,2,["value",F,"ns",$APP.p.g(M)],null);b.h?b.h(c,F):b.call(null,c,F);return n(B)})}catch(B){return $Na(b,c,B),n(null)}};$APP.dp($APP.vf([$APP.Pp,d,$APP.Bp,e,$APP.ZM,$APP.q($APP.ZM),$APP.dN,!0]));return function(){$APP.CO.h($APP.XM,$APP.Zf(function(r){r=new $APP.k(null,1,["out",r],null);
return b.h?b.h(c,r):b.call(null,c,r)}));return h(null).catch($APP.rl.j($Na,b,c)).finally(function(){var r=new $APP.k(null,2,["ns",$APP.p.g($APP.q(jY)),"status",new $APP.H(null,1,5,$APP.I,["done"],null)],null);return b.h?b.h(c,r):b.call(null,c,r)})}().finally(function(){return $APP.fp()})},fOa=function(a,b){a=$APP.xf(a);var c=$APP.D.h(a,$APP.S),d=$APP.$h.j;c=$APP.l(c)?$APP.OQ($APP.Ft(),$APP.Oi.g(c)):null;$APP.l(c)||(c=$APP.q(jY),c=$APP.l(c)?c:$APP.q($APP.Pp));return eOa(d.call($APP.$h,a,$APP.S,c),
b)},kY=function(a,b){var c=$APP.xf(a),d=$APP.D.h(c,$APP.S),e=$APP.qG.g(c);try{var f=$APP.S.g(c),h=function(){var M=$APP.Soa.g(c);return $APP.l(M)?M:$APP.cm.g(c)}(),m=function(){var M=$APP.l(d)?$APP.OQ($APP.Ft(),$APP.Oi.g(d)):null;if($APP.l(M))return M;M=$APP.q(jY);return $APP.l(M)?M:$APP.q($APP.Pp)}(),r=$APP.vf([$APP.Pp,m]);$APP.dp(r);try{var n=$APP.it($APP.Ft(),$APP.cV("\n(let [ns '%s\n      full-sym '%s]\n  (when-let [v (ns-resolve ns full-sym)]\n    (let [m (meta v)]\n      (assoc m :arglists (:arglists m)\n       :doc (:doc m)\n       :name (:name m)\n       :ns (some-\x3e m :ns ns-name)\n       :val @v))))",
f,h)),w=$APP.N.g(n),x=$APP.xl.g(n),B=$APP.yl.g(n),F=function(){var M=e instanceof $APP.G?e.S:null;switch(M){case "eldoc":return M=new $APP.k(null,5,["ns",$APP.S.g(n),"name",$APP.O.g(n),"eldoc",$APP.Qm.h(function(U){return $APP.Qm.h($APP.p,U)},$APP.Z.g(n)),"type",$APP.pe($APP.mt.g(n))?"function":"variable","status",new $APP.H(null,1,5,$APP.I,["done"],null)],null),$APP.l(w)?$APP.$h.j(M,"docstring",w):M;case "info":case "lookup":return M=new $APP.k(null,4,["ns",$APP.S.g(n),"name",$APP.O.g(n),"arglists-str",
$APP.Om.h("\n",$APP.Ii.h($APP.aj,$APP.Z.g(n))),"status",new $APP.H(null,1,5,$APP.I,["done"],null)],null),M=$APP.l(w)?$APP.$h.j(M,"doc",w):M,M=$APP.l(x)?$APP.$h.j(M,"file",x):M,$APP.l(B)?$APP.$h.j(M,"line",B):M;default:throw Error(["No matching clause: ",$APP.p.g(M)].join(""));}}();return b.h?b.h(c,F):b.call(null,c,F)}finally{$APP.fp()}}catch(M){if(M instanceof Error)return a=M,f=function(){var U=new $APP.ci(null,new $APP.k(null,1,["done",null],null),null);return $APP.z.h(e,gOa)?$APP.We.h(U,"no-eldoc"):
U}(),a=new $APP.k(null,2,["status",f,"ex",$APP.p.g(a)],null),b.h?b.h(c,a):b.call(null,c,a);throw M;}},TNa=function(a,b){a=$APP.xf(a);var c=$APP.D.h(a,$APP.qG),d=$APP.D.h(hOa,c);if($APP.l(d))return d.h?d.h(a,b):d.call(null,a,b);console.warn($APP.Om.h(" ",$APP.C(["Unhandled operation",c])));c=new $APP.k(null,1,["status",new $APP.H(null,3,5,$APP.I,["error","unknown-op","done"],null)],null);return b.h?b.h(a,c):b.call(null,a,c)},iOa=function(a){return function(b,c){return a.write(lY(c))}},jOa=function(a,
b){gY($APP.C(["Connection accepted"]));b.setNoDelay(!0);var c=WNa(),d=SNa(XNa(iOa(b))),e=$APP.cj.g(null);b.on("data",function(f){var h=$APP.q(e);if($APP.l(h)){f=[$APP.p.g(h),$APP.p.g(f)].join("");$APP.ag(e,null);var m=f}else m=f;a:for(f=$APP.C([$APP.aw,!0]),h=$APP.qg;;){var r=$APP.Xf.j(mY,m,f);m=$APP.A.j(r,0,null);r=$APP.A.j(r,1,null);if(null==m){h=new $APP.H(null,2,5,$APP.I,[h,r],null);break a}h=$APP.We.h(h,m);m=r}f=$APP.A.j(h,0,null);h=$APP.A.j(h,1,null);$APP.Lk(h)||$APP.ag(e,h);f=$APP.u(f);h=null;
for(var n=r=0;;)if(n<r)m=h.da(null,n),c(m,d),n+=1;else if(f=$APP.u(f))h=f,$APP.je(h)?(f=$APP.Kc(h),r=$APP.Lc(h),h=f,m=$APP.Gd(f),f=r,r=m):(m=$APP.v(h),c(m,d),f=$APP.y(h),h=null,r=0),n=0;else return null});return b.on("close",function(f){return $APP.l(f)?gY($APP.C(["Connection lost"])):gY($APP.C(["Connection closed"]))})},nY=function(a){return Promise.resolve($APP.NQ(esm_import$path.resolve("script.cljs"),null)).then(function(){function b(e){return $APP.fCa(new $APP.E(null,$APP.Zj,new $APP.E(null,
new $APP.E(null,$APP.Zj,new $APP.E(null,e,null,1,null),2,null),null,1,null),2,null))}var c=$APP.A.j($APP.NO,0,null),d=$APP.A.j($APP.NO,1,null);return b(c).then(function(){return b(d)})}).then(function(){var b=$APP.pl.l($APP.C([$APP.q($APP.MO),a])),c=function(){var f=$APP.UQ.g(b);return $APP.l(f)?f:0}(),d=function(){var f=$APP.qCa.g(b);return $APP.l(f)?f:"127.0.0.1"}();(function(){var f=$APP.lb(b)?b.Kl:kOa.g(b);return $APP.l(f)?f:"info"})();var e=esm_import$net.createServer($APP.rl.h(jOa,$APP.wf));
e.listen(c,d,function(){var f=e.address(),h=f.port;f=f.address;$APP.Pv.l($APP.C([["nREPL server started on port ",$APP.p.g(h)," on host ",$APP.p.g(f)," - nrepl://",$APP.p.g(f),":",$APP.p.g(h)].join("")]));$APP.CO.h($APP.dN,$APP.Zf(!0));try{return esm_import$fs.writeFileSync(".nrepl-port",$APP.p.g(h))}catch(m){return console.warn($APP.Om.h(" ",$APP.C(["Could not write .nrepl-port",m])))}});return $APP.ag(lOa,e)})},mOa=new $APP.t("nbb.impl.nrepl-server","stop-server!","nbb.impl.nrepl-server/stop-server!",
1628751782,null),dOa=new $APP.G("nrepl.middleware.print","options","nrepl.middleware.print/options",868480159),nOa=new $APP.t(null,"nbb.impl.nrepl-server","nbb.impl.nrepl-server",-1821079079,null),RNa=new $APP.G(null,"session","session",1008279103),oOa=new $APP.t("nbb.impl.nrepl-server","start-server!","nbb.impl.nrepl-server/start-server!",-2119141227,null),pOa=new $APP.G(null,"load-file","load-file",-424586670),iY=new $APP.G(null,"code","code",1586293142),kOa=new $APP.G(null,"log_level","log_level",
-1756736313),cOa=new $APP.G("nrepl.middleware.print","print","nrepl.middleware.print/print",-1616742548),qOa=new $APP.G(null,"clone","clone",711747572),rOa=new $APP.G(null,"close","close",1835149582),sOa=new $APP.G(null,"info","info",-317069002),tOa=new $APP.G(null,"macroexpand","macroexpand",-130598183),uOa=new $APP.G(null,"complete","complete",-500388775),bOa=new $APP.G(null,"_line","_line",232847719),oY=new $APP.t(null,"server","server",-1155245649,null),vOa=new $APP.G(null,"lookup","lookup",1225356838),
wOa=new $APP.G(null,"expander","expander",379138924),aOa=new $APP.G(null,"_load-file?","_load-file?",-1198848711),xOa=new $APP.G(null,"describe","describe",1369790582),gOa=new $APP.G(null,"eldoc","eldoc",-1321421900),yOa=new $APP.t(null,"stop-server!","stop-server!",-410772185,null),zOa=new $APP.G(null,"load-file?","load-file?",1892536169);var pY=function pY(a,b){switch($APP.p.g(fY(a,1))){case "i":return a=eY(a,1),b=QNa(a,"e"),new $APP.H(null,2,5,$APP.I,[parseInt(fY(a,b)),eY(a,b+1)],null);case "l":var d=a=eY(a,1);for(a=$APP.zc($APP.qg);;){if($APP.z.h($APP.p.g(fY(d,1)),"e"))return new $APP.H(null,2,5,$APP.I,[$APP.Bc(a),eY(d,1)],null);var e=pY.h?pY.h(d,b):pY.call(null,d,b),f=$APP.A.j(e,0,null),h=$APP.A.j(e,1,null);e=h;a=$APP.pg.h(a,f);d=e}case "d":for(a=eY(a,1),f=$APP.xf(b),f=$APP.D.h(f,$APP.aw),d=a,e=$APP.zc($APP.wf);;){if($APP.z.h($APP.p.g(fY(d,
1)),"e"))return new $APP.H(null,2,5,$APP.I,[$APP.Bc(e),eY(d,1)],null);a=pY.h?pY.h(d,b):pY.call(null,d,b);d=$APP.A.j(a,0,null);h=$APP.A.j(a,1,null);h=pY.h?pY.h(h,b):pY.call(null,h,b);a=$APP.A.j(h,0,null);h=$APP.A.j(h,1,null);d=$APP.l(f)?$APP.Ji.g(d):d;a=$APP.hh.j(e,d,a);d=h;e=a}default:return b=QNa(a,":"),f=parseInt(fY(a,b)),a=eY(a,b+1),new $APP.H(null,2,5,$APP.I,[$APP.p.g(fY(a,f)),eY(a,f)],null)}},mY=function mY(a){for(var c=[],d=arguments.length,e=0;;)if(e<d)c.push(arguments[e]),e+=1;else break;
return mY.l(arguments[0],1<c.length?new $APP.jd(c.slice(1),0,null):null)};mY.l=function(a,b){try{return pY(a,b)}catch(c){if(c instanceof Error)return new $APP.H(null,2,5,$APP.I,[null,a],null);throw c;}};mY.A=1;mY.G=function(a){var b=$APP.v(a);a=$APP.y(a);return this.l(b,a)};
var lY=function lY(a){for(;;){if("string"===typeof a)return[$APP.p.g(Buffer.from(a).length),":",a].join("");if(a instanceof $APP.G||a instanceof $APP.t)a=[function(){var c=$APP.cf(a);return $APP.l(c)?[c,"/"].join(""):null}(),$APP.ji(a)].join("");else return"number"===typeof a?["i",$APP.p.g(a),"e"].join(""):$APP.ce(a)||$APP.ie(a)||null==a?["l",$APP.p.g($APP.Xf.h($APP.p,$APP.Ii.h(lY,a))),"e"].join(""):$APP.ee(a)?["d",$APP.p.g($APP.Xf.h($APP.p,$APP.Ii.h(function(){return function(c){var d=$APP.A.j(c,
0,null);c=$APP.A.j(c,1,null);return[$APP.p.g(lY.g?lY.g(d):lY.call(null,d)),$APP.p.g(lY.g?lY.g(c):lY.call(null,c))].join("")}}(a),$APP.Gu.h($APP.v,a)))),"e"].join(""):null}};var jY=$APP.cj.g(null),hY=new $APP.k(null,1,["cider.nrepl.pprint/pprint",$APP.RX],null),hOa=$APP.Ih([$APP.VQ,vOa,rOa,pOa,gOa,qOa,xOa,sOa,uOa,tOa,$APP.Kta],[function(a,b){var c=new $APP.k(null,2,["status",new $APP.H(null,1,5,$APP.I,["done"],null),"classpath",$APP.Jk.h($APP.Fo(),$APP.Ai(esm_import$path.delimiter))],null);return b.h?b.h(a,c):b.call(null,a,c)},kY,function(a,b){var c=new $APP.k(null,1,["status",new $APP.H(null,1,5,$APP.I,["done"],null)],null);return b.h?b.h(a,c):b.call(null,a,c)},function(a,
b){a=$APP.xf(a);var c=$APP.D.h(a,$APP.xl);return eOa($APP.$h.l(a,iY,c,$APP.C([zOa,!0,$APP.S,$APP.q($APP.Pp)])),b)},kY,function(a,b){var c=new $APP.k(null,2,["new-session",$APP.p.g($APP.Fj()),"status",new $APP.H(null,1,5,$APP.I,["done"],null)],null);return b.h?b.h(a,c):b.call(null,a,c)},function(a,b){var c=new $APP.k(null,4,["versions",new $APP.k(null,2,["nbb-nrepl",YNa("TODO"),"node",YNa(process.version)],null),"aux",$APP.wf,"ops",$APP.ki($APP.Ii.h($APP.ji,$APP.Wh(hOa)),$APP.Lm.g($APP.wf)),"status",
new $APP.H(null,1,5,$APP.I,["done"],null)],null);return b.h?b.h(a,c):b.call(null,a,c)},kY,function(a,b){var c=$APP.pCa(a);return b.h?b.h(a,c):b.call(null,a,c)},function(a,b){a=$APP.xf(a);var c=$APP.D.h(a,iY),d=$APP.D.h(a,wOa);try{return fOa($APP.$h.j(a,iY,["( ",$APP.p.g(d),"(quote ",$APP.p.g(c),"))"].join("")),function(e,f){var h=f.g?f.g("value"):f.call(null,"value");f=$APP.l(h)?$APP.$h.j(f,"expansion",h):f;return b.h?b.h(e,f):b.call(null,e,f)})}catch(e){if(e instanceof Error)return c=new $APP.k(null,
3,["ex",$APP.p.g(e),"ns",$APP.p.g($APP.q($APP.Pp)),"status",new $APP.H(null,1,5,$APP.I,["done"],null)],null),b.h?b.h(a,c):b.call(null,a,c);throw e;}},fOa]),lOa=$APP.cj.g(null),qY=function qY(a){switch(arguments.length){case 0:return qY.C();case 1:return qY.g(arguments[0]);default:throw Error(["Invalid arity: ",$APP.p.g(arguments.length)].join(""));}};qY.C=function(){return qY.g($APP.q(lOa))};
qY.g=function(a){return a.close(function(){$APP.CO.h($APP.XM,$APP.Zf($APP.ab));$APP.CO.h($APP.dN,$APP.Zf($APP.Za));return $APP.l(esm_import$fs.existsSync(".nrepl-port"))?esm_import$fs.unlinkSync(".nrepl-port"):null})};qY.A=1;
var AOa=$APP.GO.h($APP.ix,null),BOa=new $APP.k(null,2,[$APP.TQ,function(){var a=new $APP.hd(function(){return nY},oOa,$APP.Ih([$APP.S,$APP.O,$APP.xl,$APP.Xw,$APP.om,$APP.yl,$APP.XL,$APP.Z,$APP.N,$APP.LC],[$APP.Wd(nOa,new $APP.k(null,1,[$APP.N,"Original implementation taken from https://github.com/viesti/nrepl-cljs-sci."],null)),$APP.TQ,"nbb/impl/nrepl_server.cljs",20,1,326,326,$APP.J(new $APP.H(null,1,5,$APP.I,[$APP.rE],null)),"Start nRepl server. Accepts options either as JS object or Clojure map.",
$APP.l(nY)?nY.I:null])),b=$APP.q(a),c=$APP.Xd(a);a=$APP.l(null)?null:$APP.O.g(c);var d=new $APP.k(null,4,[$APP.S,AOa,$APP.O,a,$APP.Z,$APP.Z.g(c),$APP.N,$APP.N.g(c)],null);return $APP.l($APP.Wp.g(c))?$APP.AO.j(a,b,d):$APP.l(function(){var e=$APP.pp.g(c);return $APP.l(e)?e:$APP.Dp.g(c)}())?$APP.BO.j(a,b,d):$APP.lt.j(a,b,d)}(),yOa,function(){var a=new $APP.hd(function(){return qY},mOa,$APP.Ih([$APP.S,$APP.O,$APP.xl,$APP.Xw,$APP.iI,$APP.om,$APP.yl,$APP.XL,$APP.Z,$APP.N,$APP.LC],[$APP.Wd(nOa,new $APP.k(null,
1,[$APP.N,"Original implementation taken from https://github.com/viesti/nrepl-cljs-sci."],null)),yOa,"nbb/impl/nrepl_server.cljs",19,new $APP.k(null,6,[$APP.zx,!1,$APP.Ur,1,$APP.CK,1,$APP.UJ,new $APP.H(null,2,5,$APP.I,[$APP.qg,new $APP.H(null,1,5,$APP.I,[oY],null)],null),$APP.Z,$APP.J($APP.qg,new $APP.H(null,1,5,$APP.I,[oY],null)),$APP.EC,$APP.J(null,null)],null),1,397,397,$APP.J($APP.qg,new $APP.H(null,1,5,$APP.I,[oY],null)),null,$APP.l(qY)?qY.I:null])),b=$APP.q(a),c=$APP.Xd(a);a=$APP.l(null)?null:
$APP.O.g(c);var d=new $APP.k(null,4,[$APP.S,AOa,$APP.O,a,$APP.Z,$APP.Z.g(c),$APP.N,$APP.N.g(c)],null);return $APP.l($APP.Wp.g(c))?$APP.AO.j(a,b,d):$APP.l(function(){var e=$APP.pp.g(c);return $APP.l(e)?e:$APP.Dp.g(c)}())?$APP.BO.j(a,b,d):$APP.lt.j(a,b,d)}()],null);$APP.$t(new $APP.k(null,1,[$APP.Mp,new $APP.k(null,1,[$APP.ix,BOa],null)],null));