import { $APP, shadow$provide, $jscomp } from "./nbb_core.js";
import "./nbb_api.js";
import "./nbb_goog_string.js";
import "./nbb_pprint.js";
const shadow_esm_import = function(x) { return import(x) };
import*as esm_import$node_process from"node:process";import*as esm_import$node_net from"node:net";import*as esm_import$node_fs from"node:fs";import*as esm_import$node_path from"node:path";
var yYa=function(a,b){a=a.indexOf(b);if(0>a)throw Error("out of input");return a},B_=function(a,b){if(a.length<b)throw Error("out of input");return a.slice(b)},C_=function(a,b){if(b>a.length)throw Error("out of input");return a.slice(0,b)},zYa=function(a){return(new TextEncoder).encode(a).length},D_=function(a){return $APP.l($APP.tu.g($APP.p($APP.AS)))?console.debug($APP.kn.h(" ",a)):null},BYa=function(a){return function(b,c){b=$APP.Yf(b);var d=$APP.C.h(b,$APP.yq),e=$APP.C.h(b,AYa);c=$APP.vi.j(c,
"id",d);c=$APP.l(e)?$APP.vi.j(c,"session",e):c;return a.h?a.h(b,c):a.call(null,b,c)}},DYa=function(){var a=CYa;return function(b,c){b=$APP.Zm.j(b,$APP.AJ,$APP.gj);return a.h?a.h(b,c):a.call(null,b,c)}},FYa=function(){var a=EYa();return function(b,c){D_($APP.B(["request",b]));return a.h?a.h(b,c):a.call(null,b,c)}},GYa=function(a){return function(b,c){D_($APP.B(["response",c]));return a.h?a.h(b,c):a.call(null,b,c)}},EYa=function(){var a=DYa();return function(b,c){return a.h?a.h(b,c):a.call(null,b,c)}},
HYa=function(a){return $APP.vi.j($APP.Ii(new $APP.H(null,3,5,$APP.I,["major","minor","incremental"],null),$APP.Hy.g(a.split("."))),"version-string",a)},JYa=function(a,b,c){if($APP.l(a))if(a=IYa.g?IYa.g(a):IYa.call(null,a),$APP.l(a)){b=$APP.Yf(b);var d=$APP.C.h(b,$APP.MIa),e=$APP.C.h(b,$APP.qIa),f=$APP.C.h(b,$APP.BIa);b=$APP.sb;var h=$APP.aj,n=$APP.VU;$APP.sb=e;$APP.aj=f;$APP.VU=d;try{var t=new $APP.jb;d=$APP.ub;e=$APP.vb;$APP.ub=!0;$APP.vb=function(q){return t.append(q)};try{a.g?a.g(c):a.call(null,
c)}finally{$APP.vb=e,$APP.ub=d}return $APP.m.g(t)}finally{$APP.VU=n,$APP.aj=h,$APP.sb=b}}else return D_($APP.B(["Pretty-Printing is only supported for clojure.core/prn and clojure.pprint/pprint."])),$APP.zj.l($APP.B([c]));else return $APP.zj.l($APP.B([c]))},KYa=function(a,b,c){$APP.qS.h($APP.SR,$APP.zg(c));var d=$APP.Bq.g($APP.hk(c));d=$APP.l(d)?d:c.message;$APP.l(d)&&(d=new $APP.k(null,1,["err",[$APP.m.g(d),"\n"].join("")],null),a.h?a.h(b,d):a.call(null,b,d));c=new $APP.k(null,2,["ex",$APP.m.g(c),
"ns",$APP.m.g($APP.p($APP.Fq))],null);return a.h?a.h(b,c):a.call(null,b,c)},PYa=function(a,b){var c=$APP.Yf(a),d=$APP.C.h(c,$APP.Q);a=$APP.C.h(c,E_);var e=$APP.C.h(c,$APP.Wl);$APP.C.h(c,LYa);$APP.C.h(c,MYa);var f=$APP.up(a),h=function q(t){try{var x=function(){var E=$APP.Q.g($APP.he(t));if($APP.l(E))return E;E=$APP.p(F_);return $APP.l(E)?E:d}(),z=$APP.gja(f,new $APP.k(null,3,[$APP.Q,x,$APP.Wl,e,$APP.hM,$APP.Bw],null));return $APP.y.h($APP.UH,z)?Promise.resolve(t):$APP.$Fa(z,new $APP.k(null,3,[$APP.Q,
x,$APP.Wl,e,$APP.hM,$APP.Bw],null)).then(function(E){var F=$APP.A.j(E,0,null),N=$APP.A.j(E,1,null);N=$APP.Q.g(N);$APP.Bg(F_,N);$APP.qS.h($APP.RR,$APP.zg($APP.p($APP.QR)));$APP.qS.h($APP.QR,$APP.zg($APP.p($APP.PR)));$APP.qS.h($APP.PR,$APP.zg(F));F=JYa(NYa.g(c),OYa.g(c),F);F=new $APP.k(null,2,["value",F,"ns",$APP.m.g(N)],null);b.h?b.h(c,F):b.call(null,c,F);return q(E)})}catch(E){return KYa(b,c,E),q(null)}};$APP.Vp($APP.Wf([$APP.Fq,d,$APP.rq,e,$APP.FQ,$APP.p($APP.FQ),$APP.KQ,!0]));return function(){$APP.qS.h($APP.DQ,
$APP.zg(function(t){t=new $APP.k(null,1,["out",t],null);return b.h?b.h(c,t):b.call(null,c,t)}));return h(null).catch($APP.Ol.j(KYa,b,c)).finally(function(){var t=new $APP.k(null,2,["ns",$APP.m.g($APP.p(F_)),"status",new $APP.H(null,1,5,$APP.I,["done"],null)],null);return b.h?b.h(c,t):b.call(null,c,t)})}().finally(function(){return $APP.Xp()})},QYa=function(a,b){a=$APP.Yf(a);var c=$APP.C.h(a,$APP.Q),d=$APP.vi.j;c=$APP.l(c)?$APP.eGa($APP.wu(),$APP.lj.g(c)):null;$APP.l(c)||(c=$APP.p(F_),c=$APP.l(c)?
c:$APP.p($APP.Fq));return PYa(d.call($APP.vi,a,$APP.Q,c),b)},SYa=function(a,b){var c=$APP.Yf(a),d=$APP.C.h(c,$APP.Q),e=$APP.AJ.g(c);try{var f=$APP.Q.g(c),h=function(){var N=$APP.Cqa.g(c);return $APP.l(N)?N:$APP.Am.g(c)}(),n=function(){var N=$APP.l(d)?$APP.eGa($APP.wu(),$APP.lj.g(d)):null;if($APP.l(N))return N;N=$APP.p(F_);return $APP.l(N)?N:$APP.p($APP.Fq)}(),t=$APP.Wf([$APP.Fq,n]);$APP.Vp(t);try{var q=$APP.$t($APP.wu(),$APP.A_("\n(let [ns '%s\n      full-sym '%s]\n  (when-let [v (ns-resolve ns full-sym)]\n    (let [m (meta v)]\n      (assoc m :arglists (:arglists m)\n       :doc (:doc m)\n       :name (:name m)\n       :ns (some-\x3e m :ns ns-name)\n       :val @v))))",
f,h)),x=$APP.M.g(q),z=$APP.Wl.g(q),E=$APP.Xl.g(q),F=function(){var N=e instanceof $APP.G?e.S:null;switch(N){case "eldoc":return N=new $APP.k(null,5,["ns",$APP.Q.g(q),"name",$APP.O.g(q),"eldoc",$APP.mn.h(function(S){return $APP.mn.h($APP.m,S)},$APP.Z.g(q)),"type",$APP.Ne($APP.du.g(q))?"function":"variable","status",new $APP.H(null,1,5,$APP.I,["done"],null)],null),$APP.l(x)?$APP.vi.j(N,"docstring",x):N;case "info":case "lookup":return N=new $APP.k(null,4,["ns",$APP.Q.g(q),"name",$APP.O.g(q),"arglists-str",
$APP.kn.h("\n",$APP.fj.h($APP.zj,$APP.Z.g(q))),"status",new $APP.H(null,1,5,$APP.I,["done"],null)],null),N=$APP.l(x)?$APP.vi.j(N,"doc",x):N,N=$APP.l(z)?$APP.vi.j(N,"file",z):N,$APP.l(E)?$APP.vi.j(N,"line",E):N;default:throw Error(["No matching clause: ",$APP.m.g(N)].join(""));}}();return b.h?b.h(c,F):b.call(null,c,F)}finally{$APP.Xp()}}catch(N){if(N instanceof Error)return a=N,f=function(){var S=new $APP.Bi(null,new $APP.k(null,1,["done",null],null),null);return $APP.y.h(e,RYa)?$APP.wf.h(S,"no-eldoc"):
S}(),a=new $APP.k(null,2,["status",f,"ex",$APP.m.g(a)],null),b.h?b.h(c,a):b.call(null,c,a);throw N;}},CYa=function(a,b){a=$APP.Yf(a);var c=$APP.C.h(a,$APP.AJ),d=$APP.C.h(TYa,c);if($APP.l(d))return d.h?d.h(a,b):d.call(null,a,b);console.warn($APP.kn.h(" ",$APP.B(["Unhandled operation",c])));c=new $APP.k(null,1,["status",new $APP.H(null,3,5,$APP.I,["error","unknown-op","done"],null)],null);return b.h?b.h(a,c):b.call(null,a,c)},UYa=function(a){return function(b,c){return a.write(G_(c))}},VYa=function(a,
b){D_($APP.B(["Connection accepted"]));b.setNoDelay(!0);var c=FYa(),d=BYa(GYa(UYa(b))),e=$APP.Bj.g(null);b.on("data",function(f){var h=$APP.p(e);if($APP.l(h)){f=[$APP.m.g(h),$APP.m.g(f)].join("");$APP.Bg(e,null);var n=f}else n=f;a:for(f=$APP.B([$APP.Iy,!0]),h=$APP.Sg;;){var t=$APP.sg.j(H_,n,f);n=$APP.A.j(t,0,null);t=$APP.A.j(t,1,null);if(null==n){h=new $APP.H(null,2,5,$APP.I,[h,t],null);break a}h=$APP.wf.h(h,n);n=t}f=$APP.A.j(h,0,null);h=$APP.A.j(h,1,null);$APP.jl(h)||$APP.Bg(e,h);f=$APP.u(f);h=null;
for(var q=t=0;;)if(q<t)n=h.ca(null,q),c(n,d),q+=1;else if(f=$APP.u(f))h=f,$APP.Ge(h)?(f=$APP.cd(h),t=$APP.dd(h),h=f,n=$APP.ce(f),f=t,t=n):(n=$APP.v(h),c(n,d),f=$APP.w(h),h=null,t=0),q=0;else return null});return b.on("close",function(f){return $APP.l(f)?D_($APP.B(["Connection lost"])):D_($APP.B(["Connection closed"]))})},YYa=function(a){return Promise.resolve($APP.dU(esm_import$node_path.resolve("script.cljs"),null)).then(function(){function b(e){return $APP.XFa(new $APP.D(null,$APP.zk,new $APP.D(null,
new $APP.D(null,$APP.zk,new $APP.D(null,e,null,1,null),2,null),null,1,null),2,null))}var c=$APP.A.j($APP.BS,0,null),d=$APP.A.j($APP.BS,1,null);return b(c).then(function(){return b(d)})}).then(function(){var b=$APP.Ml.l($APP.B([$APP.p($APP.AS),a])),c=function(){var f=$APP.iH.g(b);return $APP.l(f)?f:0}(),d=function(){var f=$APP.WO.g(b);return $APP.l(f)?f:"127.0.0.1"}();(function(){var f=$APP.Fb(b)?b.Ln:WYa.g(b);return $APP.l(f)?f:"info"})();var e=esm_import$node_net.createServer($APP.Ol.h(VYa,$APP.Xf));
e.listen(c,d,function(){var f=e.address(),h=f.port;f=f.address;$APP.wy.l($APP.B([["nREPL server started on port ",$APP.m.g(h)," on host ",$APP.m.g(f)," - nrepl://",$APP.m.g(f),":",$APP.m.g(h)].join("")]));$APP.qS.h($APP.KQ,$APP.zg(!0));try{return esm_import$node_fs.writeFileSync(".nrepl-port",$APP.m.g(h))}catch(n){return console.warn($APP.kn.h(" ",$APP.B(["Could not write .nrepl-port",n])))}});return $APP.Bg(XYa,e)})},ZYa=new $APP.r("nbb.impl.nrepl-server","stop-server!","nbb.impl.nrepl-server/stop-server!",
1628751782,null),OYa=new $APP.G("nrepl.middleware.print","options","nrepl.middleware.print/options",868480159),$Ya=new $APP.r(null,"nbb.impl.nrepl-server","nbb.impl.nrepl-server",-1821079079,null),AYa=new $APP.G(null,"session","session",1008279103),aZa=new $APP.r("nbb.impl.nrepl-server","start-server!","nbb.impl.nrepl-server/start-server!",-2119141227,null),bZa=new $APP.G(null,"load-file","load-file",-424586670),E_=new $APP.G(null,"code","code",1586293142),WYa=new $APP.G(null,"log_level","log_level",
-1756736313),NYa=new $APP.G("nrepl.middleware.print","print","nrepl.middleware.print/print",-1616742548),cZa=new $APP.G(null,"clone","clone",711747572),dZa=new $APP.G(null,"close","close",1835149582),eZa=new $APP.G(null,"info","info",-317069002),fZa=new $APP.G(null,"macroexpand","macroexpand",-130598183),gZa=new $APP.G(null,"complete","complete",-500388775),MYa=new $APP.G(null,"_line","_line",232847719),hZa=new $APP.r(null,"server","server",-1155245649,null),iZa=new $APP.G(null,"lookup","lookup",
1225356838),jZa=new $APP.G(null,"expander","expander",379138924),LYa=new $APP.G(null,"_load-file?","_load-file?",-1198848711),kZa=new $APP.G(null,"describe","describe",1369790582),RYa=new $APP.G(null,"eldoc","eldoc",-1321421900),lZa=new $APP.r(null,"stop-server!","stop-server!",-410772185,null),mZa=new $APP.G(null,"load-file?","load-file?",1892536169);var I_=function I_(a,b){switch($APP.m.g(C_(a,1))){case "i":return a=B_(a,1),b=yYa(a,"e"),new $APP.H(null,2,5,$APP.I,[parseInt(C_(a,b)),B_(a,b+1)],null);case "l":var d=a=B_(a,1);for(a=$APP.Tc($APP.Sg);;){if($APP.y.h($APP.m.g(C_(d,1)),"e"))return new $APP.H(null,2,5,$APP.I,[$APP.Vc(a),B_(d,1)],null);var e=I_.h?I_.h(d,b):I_.call(null,d,b),f=$APP.A.j(e,0,null),h=$APP.A.j(e,1,null);e=h;a=$APP.Rg.h(a,f);d=e}case "d":for(a=B_(a,1),f=$APP.Yf(b),f=$APP.C.h(f,$APP.Iy),d=a,e=$APP.Tc($APP.Xf);;){if($APP.y.h($APP.m.g(C_(d,
1)),"e"))return new $APP.H(null,2,5,$APP.I,[$APP.Vc(e),B_(d,1)],null);a=I_.h?I_.h(d,b):I_.call(null,d,b);d=$APP.A.j(a,0,null);h=$APP.A.j(a,1,null);h=I_.h?I_.h(h,b):I_.call(null,h,b);a=$APP.A.j(h,0,null);h=$APP.A.j(h,1,null);d=$APP.l(f)?$APP.gj.g(d):d;a=$APP.Hh.j(e,d,a);d=h;e=a}default:return b=yYa(a,":"),f=parseInt(C_(a,b)),a=B_(a,b+1),new $APP.H(null,2,5,$APP.I,[$APP.m.g(C_(a,f)),B_(a,f)],null)}},H_=function H_(a){for(var c=[],d=arguments.length,e=0;;)if(e<d)c.push(arguments[e]),e+=1;else break;
return H_.l(arguments[0],1<c.length?new $APP.Fd(c.slice(1),0,null):null)};H_.l=function(a,b){try{return I_(a,b)}catch(c){if(c instanceof Error)return new $APP.H(null,2,5,$APP.I,[null,a],null);throw c;}};H_.A=1;H_.F=function(a){var b=$APP.v(a);a=$APP.w(a);return this.l(b,a)};
var G_=function G_(a){for(;;){if("string"===typeof a)return[$APP.m.g(zYa(a)),":",a].join("");if(a instanceof $APP.G||a instanceof $APP.r)a=[function(){var c=$APP.Cf(a);return $APP.l(c)?[c,"/"].join(""):null}(),$APP.Hi(a)].join("");else return"number"===typeof a?["i",$APP.m.g(a),"e"].join(""):$APP.ze(a)||$APP.Fe(a)||null==a?["l",$APP.m.g($APP.sg.h($APP.m,$APP.fj.h(G_,a))),"e"].join(""):$APP.Ce(a)?["d",$APP.m.g($APP.sg.h($APP.m,$APP.fj.h(function(){return function(c){var d=$APP.A.j(c,0,null);c=$APP.A.j(c,
1,null);return[$APP.m.g(G_.g?G_.g(d):G_.call(null,d)),$APP.m.g(G_.g?G_.g(c):G_.call(null,c))].join("")}}(a),$APP.mx.h($APP.v,a)))),"e"].join(""):null}};var F_=$APP.Bj.g(null),IYa=new $APP.k(null,1,["cider.nrepl.pprint/pprint",$APP.AW],null),TYa=$APP.gi([$APP.eU,iZa,dZa,bZa,RYa,cZa,kZa,eZa,gZa,fZa,$APP.owa],[function(a,b){var c=new $APP.k(null,2,["status",new $APP.H(null,1,5,$APP.I,["done"],null),"classpath",$APP.hl.h($APP.wp(),$APP.$i(esm_import$node_path.delimiter))],null);return b.h?b.h(a,c):b.call(null,a,c)},SYa,function(a,b){var c=new $APP.k(null,1,["status",new $APP.H(null,1,5,$APP.I,["done"],null)],null);return b.h?b.h(a,c):b.call(null,a,c)},
function(a,b){a=$APP.Yf(a);var c=$APP.C.h(a,$APP.Wl);return PYa($APP.vi.l(a,E_,c,$APP.B([mZa,!0,$APP.Q,$APP.p($APP.Fq)])),b)},SYa,function(a,b){var c=new $APP.k(null,2,["new-session",$APP.m.g($APP.fk()),"status",new $APP.H(null,1,5,$APP.I,["done"],null)],null);return b.h?b.h(a,c):b.call(null,a,c)},function(a,b){var c=new $APP.k(null,4,["versions",new $APP.k(null,2,["nbb-nrepl",HYa("TODO"),"node",HYa(esm_import$node_process.version)],null),"aux",$APP.Xf,"ops",$APP.Ii($APP.fj.h($APP.Hi,$APP.ri(TYa)),
$APP.gn.g($APP.Xf)),"status",new $APP.H(null,1,5,$APP.I,["done"],null)],null);return b.h?b.h(a,c):b.call(null,a,c)},SYa,function(a,b){var c=$APP.kGa(a);return b.h?b.h(a,c):b.call(null,a,c)},function(a,b){a=$APP.Yf(a);var c=$APP.C.h(a,E_),d=$APP.C.h(a,jZa);try{return QYa($APP.vi.j(a,E_,["( ",$APP.m.g(d),"(quote ",$APP.m.g(c),"))"].join("")),function(e,f){var h=f.g?f.g("value"):f.call(null,"value");f=$APP.l(h)?$APP.vi.j(f,"expansion",h):f;return b.h?b.h(e,f):b.call(null,e,f)})}catch(e){if(e instanceof
Error)return c=new $APP.k(null,3,["ex",$APP.m.g(e),"ns",$APP.m.g($APP.p($APP.Fq)),"status",new $APP.H(null,1,5,$APP.I,["done"],null)],null),b.h?b.h(a,c):b.call(null,a,c);throw e;}},QYa]),XYa=$APP.Bj.g(null),J_=function J_(a){switch(arguments.length){case 0:return J_.C();case 1:return J_.g(arguments[0]);default:throw Error(["Invalid arity: ",$APP.m.g(arguments.length)].join(""));}};J_.C=function(){return J_.g($APP.p(XYa))};
J_.g=function(a){return a.close(function(){$APP.qS.h($APP.DQ,$APP.zg($APP.vb));$APP.qS.h($APP.KQ,$APP.zg($APP.ub));return $APP.l(esm_import$node_fs.existsSync(".nrepl-port"))?esm_import$node_fs.unlinkSync(".nrepl-port"):null})};J_.A=1;
var nZa=$APP.uS.h($APP.Lz,null),oZa=new $APP.k(null,2,[$APP.nGa,function(){var a=new $APP.Cd(function(){return YYa},aZa,$APP.gi([$APP.Q,$APP.O,$APP.Wl,$APP.zz,$APP.Nm,$APP.Xl,$APP.EP,$APP.Z,$APP.M,$APP.JF],[$APP.se($Ya,new $APP.k(null,1,[$APP.M,"Original implementation taken from https://github.com/viesti/nrepl-cljs-sci."],null)),$APP.nGa,"nbb/impl/nrepl_server.cljs",20,1,327,327,$APP.J(new $APP.H(null,1,5,$APP.I,[$APP.sH],null)),"Start nRepl server. Accepts options either as JS object or Clojure map.",
$APP.l(YYa)?YYa.H:null])),b=$APP.p(a),c=$APP.te(a);a=$APP.l(null)?null:$APP.O.g(c);var d=new $APP.k(null,4,[$APP.Q,nZa,$APP.O,a,$APP.Z,$APP.Z.g(c),$APP.M,$APP.M.g(c)],null);return $APP.l($APP.Mq.g(c))?$APP.gS.j(a,b,d):$APP.l(function(){var e=$APP.gq.g(c);return $APP.l(e)?e:$APP.tq.g(c)}())?$APP.hS.j(a,b,d):$APP.cu.j(a,b,d)}(),lZa,function(){var a=new $APP.Cd(function(){return J_},ZYa,$APP.gi([$APP.Q,$APP.O,$APP.Wl,$APP.zz,$APP.wL,$APP.Nm,$APP.Xl,$APP.EP,$APP.Z,$APP.M,$APP.JF],[$APP.se($Ya,new $APP.k(null,
1,[$APP.M,"Original implementation taken from https://github.com/viesti/nrepl-cljs-sci."],null)),lZa,"nbb/impl/nrepl_server.cljs",19,new $APP.k(null,6,[$APP.cA,!1,$APP.Is,1,$APP.$N,1,$APP.pN,new $APP.H(null,2,5,$APP.I,[$APP.Sg,new $APP.H(null,1,5,$APP.I,[hZa],null)],null),$APP.Z,$APP.J($APP.Sg,new $APP.H(null,1,5,$APP.I,[hZa],null)),$APP.AF,$APP.J(null,null)],null),1,398,398,$APP.J($APP.Sg,new $APP.H(null,1,5,$APP.I,[hZa],null)),null,$APP.l(J_)?J_.H:null])),b=$APP.p(a),c=$APP.te(a);a=$APP.l(null)?
null:$APP.O.g(c);var d=new $APP.k(null,4,[$APP.Q,nZa,$APP.O,a,$APP.Z,$APP.Z.g(c),$APP.M,$APP.M.g(c)],null);return $APP.l($APP.Mq.g(c))?$APP.gS.j(a,b,d):$APP.l(function(){var e=$APP.gq.g(c);return $APP.l(e)?e:$APP.tq.g(c)}())?$APP.hS.j(a,b,d):$APP.cu.j(a,b,d)}()],null);$APP.Qu(new $APP.k(null,1,[$APP.Cq,new $APP.k(null,1,[$APP.Lz,oZa],null)],null));